UC Berkeley
UC Berkeley Electronic Theses and Dissertations
Title
Control and Trajectory Generation of a Wearable Mobility Exoskeleton for Spinal Cord Injury 
Patients
Permalink
https://escholarship.org/uc/item/0xc9q3b6
Author
Swift, Timothy Alan
Publication Date
2011
 
Peer reviewed|Thesis/dissertation
eScholarship.org Powered by the California Digital Library
University of California
---------------- 
Control and Trajectory Generation of a Wearable Mobility Exoskeleton                                      
for Spinal Cord Injury Patients 
 
 
By 
 
Timothy Alan Swift 
 
 
 
A dissertation submitted in partial satisfaction of the 
 
requirements for the degree of  
 
Doctor of Philosophy 
 
in 
 
Engineering – Mechanical Engineering 
 
in the 
 
Graduate Division 
 
of the 
 
University of California, Berkeley 
 
 
 
 
Committee in charge: 
 
Professor Homayoon Kazerooni, Chair 
Professor Kameshwar Poolla 
Professor Pieter Abbeel 
 
 
Spring 2011 
 
 
---------------- 
 
 
 
----------------ABSTRACT 
 
Control and Trajectory Generation of a Wearable Mobility Exoskeleton                                         
for Spinal Cord Injury Patients 
 
By 
 
Timothy Alan Swift 
 
Doctor of Philosophy in Engineering – Mechanical Engineering 
 
University of California, Berkeley 
 
Professor Homayoon Kazerooni, Chair 
 
There are currently nearly 1.3 million people in the United States who have some form 
of lower extremity paralysis due to a spinal cord injury (SCI).  For many of these subjects, a 
wheelchair is their primary means of mobility which brings along with it a collection of health 
complications  stemming  from  extended  periods  of  time  in  a  seated  position  such  as 
osteoporosis, and impaired bowel and circulatory function.  To provide these SCI patients with 
a  viable  upright  mobility  option,  this  work  presents  the  control  structure  and  trajectory 
generation method for a mobility exoskeleton that allows them to ambulate while reliably 
generating a gait similar to that of an unimpaired subject.  This work is developed using the 
exoskeleton lower extremity gait system (eLEGS) that is developed by Berkeley Bionics.  This 
device has actuation in the sagittal plane at the hip and knee joints with a passively sprung 
ankle joint and relies on the user input through lofstrand crutches for overall balance. 
The control structure is developed using three independent control levels.  The first is 
the human machine interface (HMI) which is a discrete level that determines the user’s intent.  
Second is a trajectory generation level which is a continuous controller that translates the user 
intent into desired joint responses based on the system state information.  Finally, a low level 
controller that computes the continuous closed loop control output required for the individual 
motors to produce the desired joint response.  The trajectory generation method uses a finite 
state machine based on the primary phases of the gait where within the phases the trajectory is 
generated to allow the gait to progress.  A method of swing phase trajectory generation is 
presented using a finite state machine that develops joint trajectories to actively produce a 
desired  foot  motion.    Also  presented  are  two  theoretical  extensions  to  the  trajectory 
generation  method;  one  of  which  presents  a  nonlinear  optimization  for  a  near-optimal 
trajectory using a cost function that produces a gait similar to that of an unaffected subject and 
1 
 
----------------the other is a model free technique for planning step parameters that control to a stable gait at 
a desired velocity. 
The controller was shown to be intuitive to new users in a multi-subject pilot study that 
resulted in 6 of the 7 subjects walking unassisted using lofstrand crutches in a single two hour 
study.  Testing results also shows initial information regarding the potential learning curve for 
subjects showing that they are capable of developing a mastery of the device.  Initial results of 
energy expenditure of this device compared to conventional ambulation are presented that 
indicate  a  50%  reduction  when  using  eLEGS.   Based  on these  results,  this  robust  control 
structure and novel trajectory generation method lead to the first comprehensive and realistic 
mobility option for SCI patients. 
 
 
 
2 
 
----------------TABLE OF CONTENTS 
List of Figures .................................................................................................................................. iii 
List of Tables ................................................................................................................................... vi 
Acknowledgements ........................................................................................................................ vii 
1  Introduction ............................................................................................................................. 1 
1.1  Prior Art ............................................................................................................................ 2 
1.2  Project Description ........................................................................................................... 6 
1.3  SCI Primer ......................................................................................................................... 7 
1.4  Biomechanics Primer ........................................................................................................ 8 
2  System Description ................................................................................................................ 11 
2.1  Mechanical Design ......................................................................................................... 11 
2.2  Bracing and Adjustments ............................................................................................... 14 
2.3  Electronics and Sensors .................................................................................................. 15 
3  System Dynamics ................................................................................................................... 18 
3.1  Simplified Sagittal Plane Models .................................................................................... 18 
3.1.1  3 Degree of Freedom Model ................................................................................... 18 
3.1.2  5 Degree of Freedom Model ................................................................................... 20 
3.2  Complete Sagittal Plane Model ...................................................................................... 21 
4  Control Design ....................................................................................................................... 22 
4.1  Control Architecture ....................................................................................................... 22 
4.2  Human Machine Interface ............................................................................................. 24 
4.3  Low Level Control ........................................................................................................... 25 
4.4  Trajectory Generation .................................................................................................... 28 
5  Active Swing Phase Trajectory Generation ........................................................................... 33 
5.1  Active Trajectory Generation Structure ......................................................................... 33 
5.2  State Behavior and Descriptions .................................................................................... 35 
5.3  Active Trajectory Generation Results ............................................................................ 44 
 
i 
 
----------------6  Trajectory Generation Theoretical Extensions ...................................................................... 46 
6.1  Near Optimal Trajectory Generation ............................................................................. 47 
6.1.1  Problem Formulation .............................................................................................. 47 
6.1.2  Optimization Results ............................................................................................... 52 
6.2  Step Parameter Planning ................................................................................................ 57 
7  Subject Testing....................................................................................................................... 63 
7.1  Multi-Subject Pilot Study ................................................................................................ 63 
7.2  Patient Progression ........................................................................................................ 69 
7.3  Energy Expenditure ........................................................................................................ 71 
8  Conclusion ............................................................................................................................. 75 
8.1  Summary ........................................................................................................................ 75 
8.2  Future Work ................................................................................................................... 76 
8.3  Closing ............................................................................................................................ 78 
9  References ............................................................................................................................. 79 
10  Appendix: 3 Link Walking Model Impact Reset Derivation ............................................... 84 
11  Appendix: Trajectory Generation Blending ....................................................................... 87 
11.1  Linear Blending ............................................................................................................... 87 
11.2  First Order Continuous Blending .................................................................................... 87 
12  Appendix: Near Optimal Trajectory Generation Dynamics ............................................... 89 
 
ii 
 
----------------LIST OF FIGURES 
Figure 1.1 – Conventional Mechanical Walking Orthoses .............................................................. 2 
Figure 1.2 – Treadmill Based Rehabilitation Exoskeletons ............................................................. 4 
Figure 1.3 – Current Mobility Exoskeletons .................................................................................... 5 
Figure 1.4 – Spinal Column Nerve Roots and Injury Levels ............................................................ 7 
Figure 1.5 – Human Body Planes of Motion ................................................................................... 9 
Figure 1.6 – Unaffected Walking Sagittal Plane Kinematics ......................................................... 10 
Figure 1.7 – Unaffected Walking Gait Phases ............................................................................... 10 
Figure 2.1 – Overall view of patient in exoskeleton ..................................................................... 11 
Figure 2.2 – Hip joint degrees of freedom .................................................................................... 12 
Figure 2.3 – Knee joint degrees of freedom ................................................................................. 13 
Figure 2.4 – Ankle Joint degrees of freedom ................................................................................ 13 
Figure 2.5 – Exoskeleton bracing and adjustments ...................................................................... 14 
Figure 3.1 – 3 Degree of Freedom Walking Model ....................................................................... 18 
Figure 3.2 – Hybrid State Machine of 5 Degree of Freedom Walking Model .............................. 21 
Figure 4.1 – Overall Controller Architecture ................................................................................. 23 
Figure 4.2 – HMI Finite State Machine for Available Maneuvers ................................................. 24 
Figure 4.3 – Walking Maneuver HMI State Machine .................................................................... 24 
Figure 4.4 – Block Diagram for Arbitrary SISO Low Level Controller ............................................ 25 
Figure 4.5 – Detail of Plant Dynamics in Low Level Controller ..................................................... 26 
Figure 4.6 – Low Level Controller Tracking Results for Knee Angle ............................................. 26 
Figure 4.7 – Improved Low Level Controller with Positive Feedback Gravity Compensation...... 27 
Figure 4.8 – Basic Walking Finite State Machine for Trajectory Generation ................................ 28 
Figure 4.9 – Precalculated Swing Phase Trajectories Compared to Unimpaired Gait.................. 29 
Figure 4.10 – Linear Blending of Precalculated Swing Phase Trajectories for Continuity ............ 30 
Figure 4.11 – Typical Single Stance Joint Angle Trajectories ........................................................ 31 
Figure 4.12 – Complete Walking State Machine .......................................................................... 32 
Figure 5.1 – Active Swing Phase Trajectory Generation State Machine ...................................... 34 
Figure 5.2 – Leg Geometry for Active Trajectory Calculations ..................................................... 34 
iii 
 
----------------Figure 5.3 – Geometric Singularity Entering Swing Phase ............................................................ 35 
Figure 5.4 – Pre-Swing State Generated Joint Reference Trajectories ......................................... 36 
Figure 5.5 – Pre-Swing State Resulting Posture ............................................................................ 36 
Figure 5.6 – Toe Clearance State Generated Joint Reference Trajectories .................................. 38 
Figure 5.7 – Toe Clearance State Resulting Posture ..................................................................... 38 
Figure 5.8 – Toe Extend State Generated Joint Reference Trajectories ....................................... 40 
Figure 5.9 - Toe Extend State Resulting Posture........................................................................... 40 
Figure 5.10 – Heel Extend State Generated Joint Reference Trajectories ................................... 42 
Figure 5.11 – Heel Extend State Resulting Posture ...................................................................... 42 
Figure 5.12 – Heel Plant State Generated Joint Reference Trajectories ...................................... 43 
Figure 5.13 – Heel Plant State Resulting Posture ......................................................................... 43 
Figure 5.14 – Summary of Leg Geometry Calculation Constraints ............................................... 44 
Figure 5.15 – Active and Simple Trajectory Generation Comparison for Upright Walking .......... 45 
Figure 5.16 – Active and Simple Trajectory Generation Comparison for First Step ..................... 45 
Figure 6.1 – Implemented Control Architecture........................................................................... 46 
Figure 6.2 – Modified Control Architecture for Theoretical Trajectory Generation Extensions .. 46 
Figure 6.3 – Optimized Gait Solutions for Different Optimization Formulations ......................... 48 
Figure 6.4 – 4 Link Walking Model Diagram as Used in Trajectory Optimization ........................ 49 
Figure 6.5 – Near Optimal Swing Phase Body Posture for Normal Walking................................. 52 
Figure 6.6 – Near Optimal Hip Angle Trajectories for Normal Walking ....................................... 53 
Figure 6.7 – Near Optimal Knee Angle Trajectories for Normal Walking ..................................... 53 
Figure 6.8 – Near Optimal Knee Angle Trajectories at Various Initial Conditions ........................ 54 
Figure 6.9 – Near Optimal Hip Angle Trajectories at Various Initial Conditions .......................... 54 
Figure 6.10 – Near Optimal Swing Phase Body Posture for a First Step ....................................... 56 
Figure 6.11 – Near Optimal Joint Angle Trajectories for a First Step ........................................... 57 
Figure 6.12 – Step Parameter Planning Point Mass Model .......................................................... 59 
Figure 6.13 – Step Parameter Planning Block Diagram ................................................................ 60 
Figure 6.14 – Step Parameter Planning Velocity Tracking ............................................................ 61 
Figure 6.15 – Step Parameter Planning Varying Reference Velocity Tracking ............................. 61 
Figure 7.1 – Multi-subject Pilot Study Motion Capture Marker Locations ................................... 64 
iv 
 
----------------Figure 7.2 – Subject 2 Sagittal Plane Joint Kinematics.................................................................. 67 
Figure 7.3 – Subject 5 Sagittal Plane Knee Joint Kinematics without Exoskeleton ...................... 68 
Figure 7.4 – Subject 5 Sagittal Plane Knee Joint Kinematics with Exoskeleton ............................ 68 
Figure 7.5 – VO2 Rate Comparison for Baseline Tests ................................................................. 72 
Figure 7.6 – VO2 Rate Comparison for Walking Tests .................................................................. 73 
Figure 10.1 – Angular Momentum Conservation Conditions ....................................................... 85 
Figure 11.1 – Trajectory Generation Zero Order Continuous Blend ............................................ 87 
Figure 11.2 – Trajectory Generation First Order Continuous Blend ............................................. 88 
 
v 
 
----------------LIST OF TABLES 
Table 1.1 – Prior Art Summary of Leading Exoskeleton Devices .................................................... 6 
Table 1.2 – SCI Population Injury Level and Completeness Distributions ...................................... 8 
Table 7.1 – Multi-subject Pilot Study Subject Summary ............................................................... 65 
Table 7.2 – Multi-subject Pilot Study Spatial Temporal Parameters ............................................ 66 
Table 7.3 – Subject 1 Spatial Temporal Parameter Comparison .................................................. 70 
Table 7.4 – Subject 2 Spatial Temporal Parameter Comparison .................................................. 70 
Table 7.5 – VO2 Average Rate Comparison for Baseline Tests ..................................................... 73 
Table 7.6 – VO2 Average Comparisons for Walking Tests ............................................................ 74 
 
vi 
 
----------------ACKNOWLEDGEMENTS 
 
 
 
 
This dissertation would not have been possible except for the support and direction 
provided by the people around me throughout this process.  First I would like to thank my 
research advisor, Professor Kazerooni, for giving me access to the opportunity to work on such 
an amazing project and his continuing support of my career and development.  I am also 
grateful to the  other members  of  my  dissertation  committee  for their  input  and  support 
throughout the preparation of my dissertation. 
It is also important to note the impact that my project team has had on the success of 
this research.  Most importantly, the other controls engineers Adam Zoss and Katie Strausser 
have been instrumental in making this work what it is today and have been around since the 
beginning of the project as a source of support and friendship.  I must also thank Berkeley 
Bionics, and specifically Nathan Harding, for continuing to provide the necessary support to 
move the project forward and continually trusting my input along the way.   
Finally, and most importantly, I need to thank my family.  The influence of my parents 
helped made me the person I am today and created the character traits that have allowed me 
to make it through this process.  I must end by thanking my wife.  I am eternally thankful to you 
for the sacrifices you have made throughout our time in Berkeley.  While I will never live down 
the fact that we came here expecting a single year and are only now celebrating the end of 
school, I would not trade it for the world because of the amazing family we are leaving with.  I 
would not have made it through this in one piece without the continuous reminder of why my 
effort matters that you, Colton and the new baby have provided me. 
 
vii 
 
----------------1  INTRODUCTION 
Currently 2% of the United States population, which is 5.5 million people, lives with 
some sort of paresis [1].  There are many different causes of paresis within this population 
including stroke, multiple sclerosis and spinal cord injuries.  The patients with a spinal cord 
injury as their cause of paralysis is estimated to be nearly 1.3 million people, second only to 
stroke at 1.6 million [1].  Of those, an estimated 250 thousand patients are recovering from a 
traumatic  spinal  cord  injury  (SCI)  with  nearly  12,000  new  cases  per  year  [2].    Similarly, 
significant instances of traumatic SCI are present in countries other than the United States as 
well [3]. 
The quality of life for SCI patients is significantly affected as a result of their injury.  
Mobility is typically impaired as a result of the injury, and these patients may require extended 
gait rehabilitation or their injuries may lead to complete loss of lower extremity function 
depending on the severity of the injury.  Many of these patients are left with a wheelchair as 
their primary mode of mobility [4].  As a result of the limited mobility and prolonged wheel 
chair use, these subjects are predisposed to pressure sores, osteoporosis, deteriorating urinary 
tract and bowel function as well poor circulation.  To combat these issues, SCI patients use 
more prescription drugs than the unaffected population leading to a predisposition towards 
renal failure [5] which is a leading cause of death among this patient population [2]. 
Standing is one alternative used by patients to address these issues.  Studies indicate 
that standing can have significant benefits in the overall quality of life for these patients [6].  
Studies have also demonstrated the benefits provided by regular standing exercise such as 
increased bone health [7, 8], bowel health [6, 9], improved circulation [6] and improved renal 
function [10].  Despite these benefits, the majority of SCI patients who use a wheelchair for 
their primary mode of mobility do not stand regularly.  One analysis of the patient population 
found that 70% of the surveyed SCI subjects did not stand for a number of different reasons 
including  time  restraints  and  the  need  for  assistance  [6].    The  conventional  method  for 
stationary mechanical assisted standing is a standing frame. 
To provide the benefits of being upright and load bearing through the skeleton in a 
more functional manner, other mechanical assistive devices emerged that allowed users to be 
mobile.  The conventional devices used for mobility assistance are a reciprocating gait orthosis 
(RGO) which mechanically coordinates lower limb motion to torso motion and a knee ankle foot 
orthosis (KAFO) which holds the legs straight for load bearing as shown in Figure 1.1.  Typically 
orthotic devices such as this are not readily accepted by SCI patients for anything more than 
occasional standing exercise due to the high energy expenditure requirements they present 
[11]. 
1 
 
----------------   
(A)      (B) 
Figure 1.1 – Conventional Mechanical Walking Orthoses 
(A) Reciprocating Gait Orthosis (RGO), (B) Knee Ankle Foot Orthosis (KAFO) 
Because so few SCI patients are regularly upright, the need exists for a device that 
makes vertical ambulation a more realistic option for practical use.  This dissertation presents 
just such a device that applies the recent advances in exoskeleton technology to meet the 
practical needs of the mobile SCI patient.  More specifically, this dissertation focuses on the 
development of a control strategy centered on desired lower extremity positions and methods 
for developing those desired trajectories in order to develop the intended motion. 
1.1  PRIOR ART 
The research for active exoskeletons in medical applications has a long history.  Some of 
the initial research into legged locomotion conducted in Yugoslavia was completed on an active 
medical exoskeleton for rehabilitation of patients with lower extremity paresis [12].  While the 
research led to significant strides in the understanding and theory behind the stability of 
bipedal legged locomotion [13], it did not lead to significant practical application.  The research 
led to the development of an active rehabilitation device that was tested at a United States 
rehabilitation hospital; however, it was not used in any other fashion [14].  This initial research 
was significantly limited by the sensing and design limitations of the time which resulted in a 
cumbersome,  tethered  design  and  a  control  method  that  required  extensive  feedback 
information.  Furthermore, the control strategy was focused on developing a balanced stable 
gait and not on addressing the variation present in a mobility application. 
The next phase of the research came a number of years later and focused primarily in 
the  area  of  active  anthropomorphic  exoskeletons  for  able  bodied  users.    A  number  of 
independent projects developed near the same time for the purpose of strength augmentation 
or assistance.  One of these projects was BLEEX from the University of California, Berkeley [15] 
which is an untethered strength augmentation exoskeleton for the military that was developed 
as part of a DARPA project.  Another device developed under the same DARPA project was 
2 
 
----------------introduced by Sarcos of Salt Lake City, Utah [16] which was developed for the same application.  
The control of these devices was done primarily to augment the users strength by reducing 
interaction forces between the device and user [17].  Development of these technologies has 
continued  and  served  as  the  backbone  of  devices  that  are  currently  working  towards 
commercialization.  The Bleex device grew into the Human Universal Load Carrier (HULC) now 
developed by Berkeley Bionics in association with Lockheed Martin [18], and the Sarcos device 
became the Raytheon XOS 2 [19].  While these devices have lead to significant advancements in 
the state of the art for anthropomorphic actuation and sensing, they have fundamental issues 
that limit their use in mobility applications.  Both devices operate with a force based control 
structure which complicates use in a mobility application because so many of the operational 
constraints are position based.  In addition to that, the systems are mechanically designed to 
maintain many degrees of freedom and large ranges of motion which are not needed in this 
application.  
Another device that emerged around this time was the hybrid assistive limb (HAL) 
developed by Cyberdyne in Japan [20].  The device is an actuated full body anthropomorphic 
exoskeleton that is primarily focused on strength assistance for commercial and home use.  This 
device is much smaller than its military counterparts but is focused on providing a much smaller 
level of assistance.  The device operates in a force paradigm but instead of trying to reduce 
reaction forces between the device and the user, it responds to muscle action to indicate the 
users’ intent based on EMG signals [21, 22].  This device has since led to the development of 
HAL-5 also by Cyberdyne [20].  While the design of this device is closer aligned to the needs of 
the medical application, a problem with this control architecture is that it is entirely dependent 
on EMG signals getting to the lower extremity muscles in order to function.  However, for SCI 
patients with a severe injury, the integrity of these bioelectric signals could be compromised, 
thus degrading the overall functionality of the device. 
While  these  strength  augmenting  or  assistive  mobile  exoskeletons  have  significant 
limitations into the arena of severe SCI patients, other research has been conducted that 
focuses entirely on augmenting impaired gaits.  This line of research is in the area of treadmill 
based  exoskeletons  for  rehabilitation  of  bipedal  walking.    Some  of  these  devices  have 
progressed toward commercialization such as the Lokomat which is produced by Hocoma and 
shown in Figure 1.2 [23].  This device originated from research conducted at University Hospital 
Balgirst in Zurich, Switzerland.  The research led to a device with active hip and knee joints and 
has a control system based on gait pattern generator along with active control of the treadmill 
speed [24, 25].  The primary aspect of this control paradigm is that the pattern generator is 
primarily interested in generating a gait similar to that of an unimpaired user.  Thus, the control 
architecture  is  not  focused  on  allowing  the  user  to  maintain  a  balanced  gait  and  when 
transferred to a mobile platform, would not guarantee a user is capable of ambulating without 
falling.  Another commercialized stationary gait rehabilitation device is the Auto-Ambulator 
developed for proprietary use by Health South Corporation.  However, little is known about this 
device as little has been published regarding its function [26, 27]. 
3 
 
----------------     
(A)        (B)          (C) 
Figure 1.2 – Treadmill Based Rehabilitation Exoskeletons 
(A) Lokomat by Hocoma [23], (B) LOPES from the University of Twente [28], (C) ALEX from the University 
of Delaware [29] 
Other similar devices emerged that have since furthered the capabilities of this type of 
immobile  driven  gait  rehabilitation  as  shown  in  Figure  1.2.    One  device  is  LOPES  that  is 
developed at the University of Twente in the Netherlands which has explored the actuation and 
control of more degrees of freedom including an active pelvis [30, 31].  Another device is ALEX 
that is developed at the University of Delaware and focused on advanced control methods 
providing variable levels of assistance and force feedback to the user while still maintaining the 
desired positional constraints in order to create the intended user gait [32, 33].  Much like the 
commercial devices, a limitation of the application of these devices to a mobile application lies 
in the difference in safety requirements that are unique to the mobile use. 
In recent years, some devices have begun to address the problems associated with 
being mobile.  While many of these projects have focused on proximal joints such as active 
ankle [34-38] or knee [39] stabilization, only a few have produced mobile devices for the lower 
extremities  specific  to SCI  patients  with  severe  injuries.    One  of  these  devices  is  REX,  as 
developed by REX Bionics, which is a fully balancing, actuated lower extremity exoskeleton that 
allows the user to ride [40].  The control of this device is focused entirely on maintaining 
stability while performing a set collection of maneuvers such as sitting and standing with a 
joystick for user input.  While no information is available regarding the specifics of this device’s 
design or control, it appears to produce a gait consistent with control strategies of robotic 
walking devices such as Honda’s ASIMO [41].  The gait of this device is a great step forward in 
the area of balance in the presence of a disturbance of the subject’s interaction with the 
machine, but it is significantly limited in the area of its real world application.  Because the 
control is attempting to actively balance, it must create a sufficiently conservative gait to 
account for very likely uncertainties presented by the system model in the form of the user and 
its estimation of the environment.  The focus on stability leads to a compromised gait that is 
4 
 
----------------extremely slow and unnatural compared to an unimpaired gait and has significant theoretical 
limitation toward addressing these issues. 
   
(A)      (B) 
Figure 1.3 – Current Mobility Exoskeletons 
(A) REX Exoskeleton by REX Bionics [40], (B) ReWalk Exoskeleton by Argo Medical Technologies [42] 
Another mobile lower extremity exoskeleton is ReWalk developed by Argo Medical 
Technologies which uses a different strategy to address the uncertainty inherent to the mobility 
application [42].  ReWalk does not attempt to fully balance the user during the gait.  Instead, 
users employ lofstrad crutches to maintain the overall balance of the device while the device 
progresses the foot [43].  This approach is significantly more robust than that of REX because by 
giving the user an input through the crutches, the device can benefit from the user’s superior 
ability to process and adapt for variations in the surrounding environment or to disturbances in 
the balance.  Little information is known about the specifics of the device’s design or control 
because it is primarily a commercial device.  Despite this, some significant and limiting factors 
have been apparent in the control of this device that will impair its ability for use in mobility 
scenarios.  One factor is the abnormal gait utilized by the device.  This gait may be due to power 
limitations at the actuation or as an attempt to minimize the disturbances to the stability by 
significantly limiting joint range of motion, but it leads to increased upper extremity use to 
maintain body posture throughout the gait.  The other limiting factor is the ability of the device 
to be learned by new subjects.  This device has been in development and early subject testing 
at multiple rehabilitation centers, and very few advanced users have been demonstrated over 
this extended period of time.  If patients cannot quickly learn to use the device and then 
continue to grow in their mastery of the hardware, they will not be able to safely utilize it for 
mobility in actual environments. 
 
 
 
 
5 
 
----------------Table 1.1 – Prior Art Summary of Leading Exoskeleton Devices 
Mobile /  Disabled  Assistance  Application  # DOF’s  Control  Special Notes 
 
Tethered  Users  Goal  Controlled   Paradigm 
Lower  Treadmill based w/ 
Lokomat  N / Y  Y  Rehab  4  Position 
Extremity  body weight support 
Lower  Rehab  Treadmill based w/ 
LOPES  N / Y  Y  8  Impedance 
Extremity  Research  body weight support 
Lower  Rehab  Treadmill based w/ 
ALEX  N / Y  Y  4  Impedance 
Extremity  Research  body weight support 
Military, 
Raytheon 
Y / Y  N  Full Body  Augment  30 +  Force  Hydraulic Actuation 
XOS 2 
Strength 
Military, 
Lower 
HULC  Y / N  N  Augment  4  Force  Hydraulic Actuation 
Extremity 
Strength 
Full Body  EMG triggered 
Y (Excluding  Commercial, 
(Available  control that acts to 
HAL 5  Y / N  Complete  Strength  8  Force 
in Lower  augment requested 
Paraplegics)  Assist 
Extremity)  muscle action 
Patient uses crutches 
Lower 
ReWalk  Y / N  Y  Mobility  4  Position  to balance, Unnatural 
Extremity 
gait kinematics 
Lower  Fully Balanced, 
REX  Y / N  Y  Mobility  8  Position 
Extremity  Statically Stable Gait 
1.2  PROJECT DESCRIPTION 
This project will present the control strategy for a new mobile medical exoskeleton 
primarily for SCI mobility.  The specific device used in the development of this controller is the 
eLEGS (Exoskeleton Lower Extremity Gait System) which is developed by Berkeley Bionics.  The 
device will utilize lofstrand crutches for the overall balance of the device.  This work will focus 
on the method for determining the desired joint angle trajectories that produce the intended 
mobility maneuvers.  The methods used must be robust to the variation experienced in normal 
walking due to terrain irregularities or operation of the device.  The overall control architecture, 
as well as the methods for trajectory generation presented, will be limited to the sensing and 
actuation available on the actual hardware which is discussed in detail in a later section. 
The controller will be designed to meet a few specific goals while allowing the user to be 
mobile while using lofstrand crutches for balance.  First, the controller must be structured such 
that it is applicable to a wide range of maneuvers, environments and control methods.  The 
strategy employed must allow for adding to the available maneuvers to accommodate new 
needs without significantly limiting previous functionality.  Second, the trajectories generated 
for walking must be similar to that of an unaffected gait.  For many SCI subjects, there is 
potential to regain some muscle control, so the device must generate a healthy gait in order to 
provide a driven gait style of rehabilitation.  Third, the control output must be intuitive and 
6 
 
----------------repeatable.  This will allow users to quickly learn the function of the device and then continue 
to improve in their abilities as they adapt to the repeatable behavior of eLEGS.   
This  work  presents  an  innovative  and  simple  control  architecture  for  SCI  mobility 
exoskeletons.  Also included is a novel method of trajectory generation for a near healthy gait 
that can actively determine the desired joint angles throughout the gait.  Initial subject testing 
with the device on a subject pool is used to quantify the behavior of the device and the results 
of its interaction with the subject. 
1.3  SCI PRIMER 
Spinal  cord  injuries  are  defined  by  an  injury to the  spinal  cord that results  in the 
impairment of communication between the brain and another part of the body due to an injury 
to the nerves in the spinal column.  These injuries are classified based on the level of injury, 
which is the last remaining unaffected nerve root in the spinal cord.  The nerve roots are split 
into four sections which are the cervical (C), thoracic (T), lumbar (L) and sacral (S) as shown in 
Figure 1.4.  The individual nerve segments correspond to specific levels of function in the body 
with the most notable for this application being that injuries in the cervical region correspond 
to upper extremity and upper torso control [44].  Injuries to the cervical region are classified as 
tetraplegics, while injuries to the remaining regions are classified as paraplegics [4].  This 
application is intended primarily for paraplegics and some incomplete tetraplegics because 
sufficient upper extremity function is needed to operate the lofstrand crutches. 
Tetraplegic
Cervical (C1-C8)
Injury
Thoracic 
(T1 –T12)
Paraplegic
Injury
Lumbar
(L1 –L5)
Sacral (S1 –S5)
 
Figure 1.4 – Spinal Column Nerve Roots and Injury Levels 
Depending on the individual’s injury level and severity, a wide range of symptoms are 
possible due to a spinal cord injury.  The severity of the injury is classified based on the 
American Spinal Injury Association (ASIA) Impairment Scale or AIS, which gives a letter grade 
classifying the amount of function found in the impaired regions of the lower extremities.  The 
scale operates as below [45]: 
 
7 
 
----------------A – Complete Injury: No motor or sensory function preserved at the S5 sacral segment 
B – Incomplete Injury: Only sensory function preserved at the S5 sacral segment 
C – Incomplete Injury: Motor function preserved at the S5 sacral segment and less than 
half of the major muscle regions are strong enough to be actively controlled enough to 
overcome gravity 
D – Incomplete Injury: Motor function preserved at the S5 sacral segment and more than 
half of the major muscle regions are strong enough to be actively controlled enough to 
overcome gravity 
E – Normal: Normal motor and sensory function 
For example, a patient with an injury where the third thoracic segment is the last 
unaffected nerve root who has complete sensory function and trace motor function would be 
classified  as  a  T3  AIS  C  paraplegic  with  an  incomplete  injury.    The  estimated  population 
distribution of subjects within the ranges of injury level and completeness are presented in 
Table 1.2 [2]. 
 
Table 1.2 – SCI Population Injury Level and Completeness Distributions 
  Complete  Incomplete 
Tetraplegic  20.4 %  30.1 % 
Paraplegic  25.6 %  18.5 % 
1.4  BIOMECHANICS PRIMER 
In this work, standard biomechanic terminology and concepts will be discussed that the 
reader must have an understanding of in order to follow the presented controller design.  
When referencing the motion of the human body, the body is defined in three independent 
planes as shown in Figure 1.5.  These are the coronal plane which splits the body into front and 
back segments, the sagittal plane which splits the body into right and left segments, and the 
transverse plane which splits the body into top and bottom segments.  The angular motion of 
the joints are defined with flexion and extension as movements relative to the sagittal plane 
where flexion is a motion that decreases the angle between body segments and extension 
increases the angle.  Similarly, abduction and adduction are motions relative to the coronal 
plane where abduction moves the body segments away from the coronal plane while adduction 
moves the segments toward it [46].  The primary direction of motion considered during walking 
is in the sagittal plane, and this is the only direction with active actuation in this device. 
8 
 
---------------- 
Figure 1.5 – Human Body Planes of Motion  
A repetitive walking gait for a healthy, unaffected human subject is a very well studied 
and  understood  concept.   The  sagittal plane  angles  developed during  the  gait  have been 
evaluated by many different sources; however, while the joint angles vary between individual 
users, a clear pattern is evident.  This can be seen by the sagittal plane hip and knee joint angles 
developed as shown in Figure 1.6. This normal pattern is delineated into two primary phases of 
walking, stance and swing as seen in Figure 1.7.  The entire stance phase for a single leg 
typically covers the first 60% of the gait cycle.  Also apparent is that the gait has two double 
stance phases that take 10% of the cycle that are characterized by both legs being on the 
ground at the same time [50]. 
 
 
9 
 
----------------80   40  
Winter CGA
70
Kirtley CGA 30
60 Linskell CGA
20
g] 50 g]
e e
d d
e [ 40 e [ 10
gl gl
n n
A 30 A 0
nt  nt 
oi 20 oi
J J -10
10 Winter CGA
-20 Kirtley CGA
0
Linskell CGA
-10  -30 
0 20 40 60 80 100 0 20 40 60 80 100
Cycle Percentage [%] Cycle Percentage [%]  
(A)              (B) 
Figure 1.6 – Unaffected Walking Sagittal Plane Kinematics 
(A) Knee Joint, (B) Hip Joint angles from CGA (Clinical Gait Analysis).                                                            
Data from Winter [47], Kirtley [48] and Linskell [49]. 
 
 
Figure 1.7 – Unaffected Walking Gait Phases 
 
10 
 
----------------2  SYSTEM DESCRIPTION 
The device used in this system is an anthropomorphic under actuated lower extremity 
exoskeleton.    In  this  particular  application,  the  system  control  strategies  that  can  be 
implemented are significantly tied to the behavior of the device as well as the available sensor 
information.  If a control strategy is developed that relies on a certain sensor feedback or an 
expected mechanical stiffness at a joint that is not realizable, then the control can potentially 
lead to instability.  For this reason, it is essential that the performance capabilities of the device 
are used as the backbone of the control strategies presented in the later sections of this 
dissertation. 
This device is a mechatronic device that has a subject strapped directly in the middle of 
the system through backpack style torso strapping as seen in Figure 2.1.  The device is designed 
so that it can be easily adjusted to fit a range of users between 5’2” and 6’4” and up to 220 lbs.  
For this reason, there are a few aspects of the design that require closer inspection. The first 
area is the mechanical design including the actuation and ranges of motion provided in the 
system.  The second area is the strapping used to secure the user to the device.  The final 
section of the system that requires closer inspection is the available sensor feedback. 
 
Figure 2.1 – Overall view of patient in exoskeleton 
2.1  MECHANICAL DESIGN 
  The device is completely mobile and has all power, actuation and processing on 
board.  It is electrically powered and has four electric actuation units to control the hip and 
knee joints of both legs in the sagittal plane.  The actuators at each of these joints have electric 
motors and use ballscrew and a linkage to transmit torque to the joint.  The only actuated 
degrees  of freedom  are  the  flexion  and  extension  directions for  the  hips  and  knees.   All 
remaining degrees of freedom are either locked out or passively sprung.  Every joint on the 
machine that allows for motion, whether actuated or passive, includes mechanical hardstops at 
the extents of the ranges of motion to protect the user in the event of a failure. 
11 
 
----------------At the hip joint, as shown in Figure 2.2, the range of motion allowed in the sagittal plane 
is -20° to 135° flexion.  This range was selected to allow for effective walking as well as sitting.  
The actuation unit for this joint is located just above the axis of rotation and fixed to the torso.  
Based on the actuation provided, this joint has a peak speed of 14.9 rad/s [856°/s] and a peak 
torque of 82 Nm [60.6 ft lb].  In the abduction/adduction direction, the joint is normally locked 
but has a manual release mechanism to allow the joint to freely abduct through a range of 
motion of 0° to 55° abduction as seen in Figure 2.2.  The primary use for the free abduction is 
for donning and doffing of the device.  The hip also allows for rotation in the transverse plane 
along the axis of the thigh segment as shown in Figure 2.2.  This joint is passively sprung 
through the range of ±45° from the neutral position that holds the foot parallel to the sagittal 
plane and a large detent torque at the neutral position.  This degree of freedom is included for 
the benefit of turning while in a standing position and then straightening the foot while in 
swing. 
Ab/adduction 
Lock
Passive 
Rotation Joint
   
(A)         (B)   
Figure 2.2 – Hip joint degrees of freedom 
(A) Sagittal plane actuated flexion/extension DOF, (B) Manual adduction/abduction lock DOF and passive 
rotation DOF in transverse plane 
The actuation units used to actuate the hips, and similarly the knees, use a brushless DC 
electric motor.  They were selected to provide the necessary power requirements at the joint to 
meet normal walking requirements and for standing and going up stairs based on standard 
biomechanic data similar to that of previous research in this area [51].  The gear ratio between 
the motor and the joint averages approximately 80:1 throughout the normal operating range of 
the joints.  The transmission used to provide this large gear ratio is a ballscrew fixed directly to 
the motor, with the nut of the motor fixed to a linkage about the joint to transmit the linear 
motion of the ballscrew nut into rotational motion at the joint.  The specifics of this linkage and 
the geometry of the actuator are selected to maintain a reasonable lever arm at the joint 
throughout the entire range of motion of the joint.  These linkages differ greatly between the 
actuation units used at the hip and knee joints because of differences in the ranges of motion 
and the locations in those ranges that require the peak torque. 
12 
 
----------------At the knee joint, as shown in Figure 2.3, the range of motion allowed in the sagittal 
plane is 0° to 120° flexion.  Similar to the hip, this range of motion was selected to allow for 
effective walking as well as moving from sitting to standing.  Based on the actuation provided, 
this joint has a peak speed of 15.6 rad/s [896 °/s] and a peak torque of 83 Nm [113.1 ft lb].  The 
actuation unit for this joint is located above the knee axis of rotation fixed to the thigh.  All 
other degrees of freedom at this joint are locked out. 
 
Figure 2.3 – Knee joint degrees of freedom 
Only a sagittal plane actuated flexion/extension DOF 
The ankle joint has no active actuation but is passively sprung through the range of -10° 
to 20° dorsiflexion as seen in Figure 2.4.  The joint is center sprung to a neutral position of 5° 
dorsiflexion.  The torque provided at this joint is much less than can be generated by a healthy 
human ankle [50]; however, the primary peak torques in an unimpaired gait are due to active 
push-off in the late stance phase which are not supported by the passive spring assembly.  The 
design decision to not provide active actuation at this joint was made primarily because except 
for push-off, the passive joint can provide all functions of an unimpaired gait.  All other degrees 
of freedom at this joint are locked out. 
 
Figure 2.4 – Ankle Joint degrees of freedom 
Only a sagittal plane passive DOF 
13 
 
----------------There are no other mechanically provided ranges of motion in the device although there 
are some locations where motion happens that affects the behavior of the device.  One such 
area is the sole of the foot.  The sole of the foot is a carbon fiber plate that is designed to allow 
for flexing near the ball of the foot on a standard user.  The primary functionality of this motion 
is to allow the user to maintain a large area of contact with the ground throughout the entire 
step, including late stance where the heel of the foot can lift off the ground.  By allowing the 
foot to flex, the subject’s forefoot maintains ground contact as opposed to progressing onto the 
tip  of  the  toe  as  would happen  in  a  stiff  foot  option,  thereby  reducing the  likelihood  of 
transverse plane rotation about the toe.  The other primary source of motion in the device that 
is not encompassed in the mechanical degrees of freedom is the motion provided to the user’s 
upper torso by the strapping.  That motion has the ability to significantly affect the behavior of 
the device but is allowed because it is a portion of the body that the user has sufficient control 
over. 
2.2  BRACING AND ADJUSTMENTS 
The device provides three primary adjustments to fit the device to a given user within 
the range of allowable users as seen in Figure 2.5.  The first of these adjustments is the length 
of the thigh which can be adjusted by loosening a clamp on the thigh of the exoskeleton just 
below the hip joint.  The next adjustment is used to adjust the length of the shank and is 
located just above the ankle and below the shin bracing.  The final adjustment is the hip width, 
which allows the coronal plane width between the two hip joints to be adjusted to match the 
user.  All of these adjustments are used to align the device’s joints with that of the user to 
ensure a better coupling of the user to the machine throughout the entire range of motion. 
 
Figure 2.5 – Exoskeleton bracing and adjustments 
Hip width adjustment not shown, located between hip actuators at bottom of torso.   
The strapping provided by the system is intended to secure the user’s lower extremities 
to the legs of the system and maintain this connection throughout the entire range of motion 
of the device.  The strapping is not attempting to lift or suspend the user; instead, it aims to 
14 
 
----------------control the position of the user’s body and allow the loads due to the user’s weight to be 
directed to the ground through the feet of the user.  Another key facet of this strapping is that 
it allows for unassisted donning and doffing of the device by the user.  This entails all torso 
strapping coming into the user from behind, allowing the user to transfer into the seated 
machine and then strap in, with all lower extremity strapping attaching to the user from the 
side so the user can then pull the legs of the device into theirs as seen in Figure 2.5. 
At the torso, there is a harness that attaches to the user’s back with backpack style 
shoulder straps and includes a corset style abdomen strap to synch the body into the machine.  
This torso strapping is primarily to control the motion of the subject’s torso relative to the 
device torso in the transverse plane. The shoulder straps do not bear any vertical load, and the 
torso corset is not tightened enough to allow for significant vertical loading of the device.  The 
other significant torso padding is the sacral pad.  This pad prevents the torso of the user from 
slipping out of the back of the device due to a sagittal pelvic tilt, which in early prototypes was a 
primary source of rubbing and chafing for the user. 
The legs incorporate a high thigh strap that is rigid on the front of the leg and fabric on 
the back.  The strap is fixed to the machine above the thigh adjustment to dictate the distance 
of the strap relative to the torso and not relative to the knee.  The purpose of the strap is to 
hold the user’s pelvis into the device when the hip is bent and the torso wants to slide out of 
the machine parallel to the sacral pad.  If the strap was fixed relative to the knee, taller users 
would have a large area between the strap and the torso allowing for the small amount of 
deflection provided by the fabric padding to result in large misalignments which lead to binding 
and rubbing on the user. 
Another leg brace that is essential to coupling the user to the machine is the shin brace 
located on the shank at a fixed distance relative to the knee.  This brace typically takes a good 
deal of load while users are in the machine because it is the primary source of resistance to the 
user’s knees buckling when loaded.  To accommodate these forces, the bracing has a large 
contact area with the skin of the user to reduce the resulting contact pressure.  The final 
strapping provided by the device is the foot binding.  There are no large loads imparted on the 
user by the bindings during normal use.  Their primary use is to control the transverse plane 
positioning of the foot relative to the exoskeleton ankle.  Because the user does not experience 
significant loading in these directions, this strap can be addressed with a number of different 
methods including a flexible plastic shoe binding or a simple fabric strap. 
2.3  ELECTRONICS AND SENSORS 
The majority of the electronics of the system reside on the back of the device.  The 
system is run using a Texas Instruments DSP processor running at 100 mhz that is used to do all 
the  analog  sensor  processing,  as  well  as  the  control  code  execution  and  communication 
including that done with the motor drives.  In addition to the DSP, the custom built electronics 
board also incorporates a FPGA running at 25 mhz that is used to process the digital sensor 
inputs and pass the information on to the processor.  One of the primary benefits provided by 
15 
 
----------------this architecture is that the FPGA runs significantly faster than the control cycle on the DSP and 
thus is able to generate a much more accurate calculation of velocities coming from the digital 
encoders  than  if  the  velocity  was  calculated  on  the  DSP.    This  high  accuracy  velocity 
measurement makes much more feasible the application of controller damping without the 
standard issues of large noise disturbances. 
On the whole, this system has very few sensors considering the large number of degrees 
of freedom provided to the user.  The first sensors in the system are analog pressure sensors 
located in the feet.  These sensors are custom designed and built, and they incorporate a force 
resistive fabric stack-up to measure heel and toe pressures on each foot.  These sensors are 
designed to measure the load through the foot onto the ground and thus include loading that 
comes through the foot due to loading in the exoskeleton itself.  The signal provided by this 
sensor is thus related to the ground reaction force for the entire system as opposed to only the 
downward forces of the user onto the foot, so no sensing is available to isolate loading through 
the user and through the device. 
To keep the sensors simple, some design compromises were made that affect the 
usefulness of these sensors.  First, because the sensor is measuring two large pressure areas at 
the toe and heel of the foot, the sensor response varies significantly based on the loading 
conditions.  Because the sensor relies on its ability to strain when loaded to change resistance, 
as the primary load path moves towards the edge or off the sensing area, the response should 
be expected to vary.  Thus, these sensors present the potential to not respond to some extreme 
loading patterns that, while not typical, are possible.  Thus the sensors are primarily used as a 
software trigger with the understanding that if triggered the foot is guaranteed to be on the 
ground while if not triggered it may be in slight contact with the ground still.  The next issue 
with the use of these sensors is that the sensor information returned is not equivalent to the 
ground reaction force of the system; instead, it is only related.  While attempts have been 
made to model the system loading and generate a frequency domain transfer function between 
load and sensor output [52], the practical use of these types of sensors does not allow it.  In 
application, the loading conditions are not constant through the walking cycle as the center of 
pressure on the foot is moving significantly.  Thus, while a transfer function can be assumed to 
exist based on a simple spring damper foot model for any specific foot placement and loading 
condition, there is no reason to expect that the acquired transfer function will apply to all 
conditions encountered by the sensor so an estimated force could not be trusted. 
The next set of sensors are used to measure joint angle of the four actuated joints.  Each 
actuation unit includes an analog potentiometer measuring the travel of the ballscrew nut 
throughout the entire range of motion, as well as a 2048 count optical encoder fixed to the 
motor.  While both of these sensors measure the linear travel of the ballscrew, the mechanical 
linkage provides a well defined geometric relationship between the linear travel of the nut on 
the ballscrew and the joint angle.  In this case, the high tolerances of the linkage members as 
well as their significant stiffness allows for a geometric relationship to be sufficient as opposed 
to a transfer function.  By using the redundant sensing provided, the joint angle can operate 
without any homing procedure by using the potentiometer to estimate absolute position and 
16 
 
----------------then the encoder to make a better estimation of local relative motion.  This means that the 
system can have the performance of an absolute encoder while only having to package a 
standard encoder in the mechanical design.  Also, by basing all joint measurements off the 
ballscrew travel and placing a moderate resolution encoder on the motor side of the gear ratio 
created by the linkage, very high joint angle resolution can be obtained at the joint.  For 
example, at the hip joint a resolution of nearly 1000 encoder counts per joint degree exists, 
which results in just over 153 thousand encoder counts in the 155° range of motion. 
The only other sensors used in the primary machine control is an analog two-axis 
accelerometer and gyroscope which are used to measure the orientation of the user’s torso 
relative to gravity.  The two pieces of sensor information are combined using a Kalman filter to 
result in the angle of the torso in the sagittal plane relative to gravity.  This sensor package has 
a relatively low bandwidth limit as specified by the manufacturer of 30 hz.  The bandwidth has 
come into play when evaluating some high level control strategies such as active balancing.  The 
system also has access to some optional pieces of sensor information but these are currently 
used only for high level human machine interface (HMI) applications and not in the active 
control.  These sensors are accelerometers and gyroscopes on each arm of the user for an 
absolute angle measurement of the upper arm as well as analog forces of loading in each 
crutch. 
17 
 
----------------3  SYSTEM DYNAMICS 
One  of  the  major  factors  that  has  driven  the  overall  architecture  of  the  control 
algorithms developed for this device is the system dynamics.  The dynamics of bipedal walking 
has been extensively evaluated in a number of resources [53, 54].  The standard methodology 
for evaluating the human gait is to simplify the system, in order to model only the motions in 
the sagittal plane.  This simplification is typically made because the dynamics resulting in 
forward progression are the primary focus; however, some models have taken into account the 
three dimensional nature of the bipedal gait [55].  For the purposes of this application, the 
sagittal plane simplification will be made because the focus is to take forward steps.  In addition 
to this, it is assumed that the user can handle the out of plane forces using the provided 
lofstrand crutches. 
There  are  a  few  primary  characteristics  of  bipedal  walking  that  greatly  affect  the 
resulting dynamic equations.  The first is that the dynamics are extremely hybrid [56].  The 
hybrid nature of the bipedal gait is induced by the discrete changes in support due to the feet 
leaving and contacting the ground.  This characteristic results in a series of representative 
dynamic equations for the different states the system is in.  The second characteristic of the 
system dynamics is they are nonlinear and provide no clear method for linearization.  This is 
because the dynamics appear very similar to an inverted pendulum with varying numbers of 
links depending on the complexity of the model.  The included simplified models are used later 
in this dissertation for simulations and dynamic analysis. 
3.1  SIMPLIFIED SAGITTAL PLANE MODELS 
3.1.1  3 DEGREE OF FREEDOM MODEL 
The simplest of the sagittal plane walking models is that of a stick legged walker as 
shown in Figure 3.1.  This model is representative of a bipedal walker with a single link for the 
torso and for each leg respectively with no knees.  The system has six state variables, the angles 
of each of the three links and their angular velocities. 
 
Figure 3.1 – 3 Degree of Freedom Walking Model 
18 
 
----------------Using Legrangian dynamics, the dynamic equations for a standard single support phase 
can  be  determined  as  shown  in  Equation  3.1.    These  dynamic  equations  are  reasonably 
complicated and demonstrate nonlinearities even for this significantly simplified sagittal model.   
 
−(cid:16)(cid:17)(cid:18)
(cid:1)(cid:2)(cid:3)(cid:4)(cid:3)(cid:5) +(cid:7)(cid:8)(cid:3),(cid:3)(cid:10)(cid:11)(cid:3)(cid:10) +(cid:12)(cid:2)(cid:3)(cid:4) = (cid:14) −(cid:16)(cid:17)(cid:19) (cid:20)
(cid:16)(cid:17)(cid:18) +(cid:16)(cid:17)(cid:19) Equation 3.1 
where 
(cid:25) (cid:25)
 
(cid:22)(cid:23)(cid:24)(cid:23) +(cid:2)(cid:22)(cid:23) +(cid:22)(cid:26)(cid:4)(cid:27)(cid:23) −(cid:22)(cid:23)(cid:28)(cid:23)(cid:27)(cid:23)cos∆(cid:3)! (cid:22)(cid:26)(cid:24)(cid:26)(cid:27)(cid:23)cos∆(cid:3)(cid:25)
(cid:25)
(cid:1)(cid:2)(cid:3)(cid:4) = (cid:21) −(cid:22)(cid:23)(cid:28)(cid:23)(cid:27)(cid:23)cos∆(cid:3)! (cid:22)(cid:23)(cid:28)(cid:23) 0 #
(cid:25)
(cid:22)(cid:26)(cid:24)(cid:26)(cid:27)(cid:23)cos∆(cid:3)(cid:25) 0 (cid:22)(cid:26)(cid:24)(cid:26)
0 −(cid:22)(cid:23)(cid:28)(cid:23)(cid:27)(cid:23)(cid:3)(cid:17)(cid:10) (cid:19)sin∆(cid:3)! (cid:22)(cid:26)(cid:24)(cid:26)(cid:27)(cid:23)(cid:3)(cid:17)(cid:10) (cid:18)sin∆(cid:3)(cid:25)  
(cid:7)(cid:8)(cid:3),(cid:3)(cid:10)(cid:11) = (cid:21) (cid:22)(cid:23)(cid:28)(cid:23)(cid:27)(cid:23)(cid:3)(cid:17)(cid:10) (cid:18)sin∆(cid:3)! 0 0 #
−(cid:22)(cid:26)(cid:24)(cid:26)(cid:27)(cid:23)(cid:3)(cid:17)(cid:10) (cid:18)sin∆(cid:3)(cid:25) 0 0
 
(cid:2)(cid:22)(cid:23)(cid:24)(cid:23) +(cid:2)(cid:22)(cid:23) +(cid:22)(cid:26)(cid:4)(cid:27)(cid:23)(cid:4)&cos(cid:3)(cid:17)(cid:18)
(cid:12)(cid:2)(cid:3)(cid:4) = (cid:14) −(cid:22)(cid:23)(cid:28)(cid:23)&cos(cid:3)(cid:17)(cid:19) (cid:20)
(cid:22)(cid:26)(cid:24)(cid:26)&cos (cid:3)(cid:26)
∆(cid:3)! = (cid:3)(cid:17)(cid:18) −(cid:3)(cid:17)(cid:19) 
∆(cid:3)(cid:25) = (cid:3)(cid:17)(cid:18) −(cid:3)(cid:26)
The dynamics developed above are representative of the dynamics for the torso, stance 
and swing links of the simplified model in a single stance phase.  Thus, as the walker progresses 
forward and the leg links oscillate between stance and swing phases, the dynamic equations for 
the  motion  of  a  single  link  discretely  change  based  on  the  foot  contact  conditions.  This 
characteristic is the hybrid dynamics of the system.  In this system, it is important to note, there 
is no double stance phase or double swing phase.  Because of the conservation of angular 
momentum about the swing foot at heelstrike, the support of the body appears to instantly 
transfer from one foot to the other. 
Another significant factor in the dynamics is the hybrid state resets that instantaneously 
modify the state dynamics as the system transfers from one state to another.  In this particular 
system the reset is due to impact of the swing leg with the ground.  The state reset is calculated 
using rigid body impact dynamics and the conservation of angular momentum [57, 58].  This 
impact model allows for an instantaneous impact and a discontinuity in angular velocity but not 
in the angle of any segment.  In this simple three link example, three conditions must be met to 
compute the conservation of angular momentum at impact.  Those conditions are a) the 
conservation of angular momentum of the entire body about the impact foot, b) of the torso 
link about the hip joint and c) of the original stance leg about the hip joint.  Using these three 
conditions, the state transition reset can be determined as shown in Equation 3.2.  A complete 
19 
 
----------------derivation of these equations can be found in the appendix of this dissertation in Section 10.  In 
this equation,   is the angle of the stance leg prior to impact and becomes the swing leg 
following heelstrike, and   corresponds to the other leg. 
(cid:3)!
(cid:3)(cid:25)
( )
(cid:3)(cid:10)! (cid:3)(cid:10)!  
( ( ) )
' (cid:21)(cid:3)(cid:10)(cid:25)# = ' (cid:21)(cid:3)(cid:10)(cid:25)#
( )
(cid:3)(cid:10)(cid:26) (cid:3)(cid:10)(cid:26) Equation 3.2 
where 
 
* −(cid:22)(cid:23)(cid:24)(cid:23)(cid:28)(cid:23) (cid:22)(cid:26)(cid:24)(cid:26)(cid:2)(cid:27)(cid:23)cos(cid:2)(cid:3)(cid:25) −(cid:3)(cid:26)(cid:4)+(cid:24)(cid:26)(cid:4)
(
' = (cid:21) −(cid:22)(cid:23)(cid:24)(cid:23)(cid:28)(cid:23) 0 0 #
(cid:25)
(cid:22)(cid:26)(cid:24)(cid:26)(cid:27)(cid:23)cos(cid:2)(cid:3)! −(cid:3)(cid:26)(cid:4) 0 (cid:22)(cid:26)(cid:24)(cid:26)  
* = (cid:2)2(cid:22)(cid:23)(cid:24)(cid:23) +(cid:22)(cid:26)(cid:27)(cid:23)(cid:4)(cid:27)(cid:23)cos(cid:2)(cid:3)! −(cid:3)(cid:25)(cid:4)+(cid:22)(cid:26)(cid:24)(cid:26)(cid:27)(cid:23)cos(cid:2)(cid:3)! −(cid:3)(cid:26)(cid:4)−(cid:22)(cid:23)(cid:28)(cid:23)(cid:24)(cid:23)
(cid:22)(cid:23)(cid:28)(cid:23)(cid:2)(cid:28)(cid:23) −(cid:27)(cid:23)cos(cid:2)(cid:3)! −(cid:3)(cid:25)(cid:4)(cid:4) , (cid:22)(cid:26)(cid:24)(cid:26)(cid:2)(cid:27)(cid:23)cos(cid:2)(cid:3)(cid:25) −(cid:3)(cid:26)(cid:4)+(cid:24)(cid:26)(cid:4)  
) (cid:25)
' = (cid:21) (cid:22)(cid:23)(cid:28)(cid:23) −(cid:22)(cid:23)(cid:28)(cid:23)(cid:27)(cid:23)cos(cid:2)(cid:3)! −(cid:3)(cid:25)(cid:4) 0 #
(cid:25)
0 (cid:22)(cid:26)(cid:24)(cid:26)(cid:27)(cid:23)cos(cid:2)(cid:3)(cid:25) −(cid:3)(cid:26)(cid:4) (cid:22)(cid:26)(cid:24)(cid:26)
 
(cid:25) (cid:25)
At ,th=is (cid:22)po(cid:23)i(cid:24)n(cid:23)t +all(cid:2) t(cid:22)he(cid:23) +dy(cid:22)na(cid:26)m(cid:4)(cid:27)ic(cid:23)s− ar(cid:22)e (cid:23)p(cid:28)r(cid:23)e(cid:27)s(cid:23)encot st(cid:2)o(cid:3) !sim−u(cid:3)l(cid:25)a(cid:4)te+ th(cid:22)e(cid:26) t(cid:24)h(cid:26)r(cid:27)e(cid:23)ec olins(cid:2)k(cid:3) s(cid:25)im−p(cid:3)li(cid:26)fi(cid:4)ed sagittal 
walker.  This model is a significant simplification from a complete walking model; however, it is 
still  useful  in  situations  where  the  impact  dynamics  of  heelstrike  are  the  significant 
characteristic being represented.  For this reason, the three link model presented here is used 
in some of the verification of control developed in later sections of this dissertation. 
3.1.2  5 DEGREE OF FREEDOM MODEL 
The next sagittal plane walking model incorporates knees into both legs to result in a 
five link system.  The dynamics for this walking model has 10 state variables, in particular, the 
angles and angular velocities of the torso, two thighs and two lower legs.  The dynamics for this 
system, despite being much longer, are obtained in a similar manner as those of the three link 
system using legrangian dynamics.   
The largest difference that this model presents is the potential for additional hybrid 
states.  When this model is typically used for analysis, the knee joints are restricted to be within 
the normal operating ranges that knees provide by not allowing them to hyper-extend beyond 
the angle of the thigh.  These additional states lead to a walking state machine with eight total 
states in it and, in turn, more than just a single reset condition as this model allows 24 state 
transitions as shown in Figure 3.2.  Just as in the three link model, the resets are handled by the 
concept of conservation of angular momentum.  Still, if the ranges of motion condition is not 
added to the system because in normal operation the model should not encounter the limits of 
motion, the model will have the same two states as the three link model. 
20 
 
---------------- 
Figure 3.2 – Hybrid State Machine of 5 Degree of Freedom Walking Model 
The following abbreviations are included in the figure for clarity: L1 = Leg 1, L2 = Leg 2, ST = Stance,      
SW = Swing, Free = Free Knee, Extended = Knee at Full Extension Hard Stop 
3.2  COMPLETE SAGITTAL PLANE MODEL 
The biggest problem with the simplified sagittal plane models presented so far is that 
they do not accurately represent the dynamics of the system throughout the entire step.  Even 
by continuing to expand the model, it will still be a significant simplification of the actual 
system.  There are a few factors that exist in the actual system that can be added to a more 
advanced model.  The most obvious method would involve the addition of feet in order to 
accurately represent the double stance phases of the gait along with realistic ground loading 
patterns.    Another  is  the  addition  of  range  of  motion  limits  that  are  reached  in  normal 
operation of the device such as the ankle plantarflexion and dorsiflexion limits, and the hip 
extension limit along with the knee extension limit which would all greatly increase the number 
of states in the model.  Another expansion of the model involves the extension to three 
dimensions because while the largest joint motions happen in the sagittal plane, the out of 
plane motions play a significant role in the behavior of the system. 
The most significant factor limiting the development of a fully representative model is 
that in actual application, this system relies on the input of the user to achieve stability through 
the lofstrand crutches.  Because there is no method to model the decisions a user will make 
with their arms to control the crutches when presented with the exoskeleton, it is impossible to 
simulate that behavior.  In turn, the stability of the control implemented on the actual device 
can only be verified when tested on a wide range of users in applications and not in simulation 
of a complete or representative model. 
21 
 
----------------4  CONTROL DESIGN 
The purpose of this device is to create a platform that provides reliable, intuitive and 
natural walking for patients with impaired lower extremity function due to a spinal cord injury.  
All aspects of the proposed control strategy are reflected in this focus.  Before laying out a 
control design for this particular application, it is important to identify some of the major 
requirements that the controller must meet. 
The first of those requirements is that because the device involves a human subject, the 
safety of that subject must be the highest concern at all times.  Given that the user is primarily 
walking, which is an inherently unstable maneuver, the controller must maintain a minimal risk 
level at all times by not introducing any control methods that may lead to harming the user.  
Second, the  control  architecture  must have  an  expandable  and  adaptive  structure  so the 
control methods and insights developed in walking can be applied to other maneuvers.  The 
next goal of the controller is to be capable of generating a natural reciprocal gait for the user.  
Due to the fact that many of the patients who may use this device have the potential of 
regaining some amount of muscle control due to the rehabilitative benefits of this type of 
device, it is important to make sure that they are being trained in a realistic healthy gait. 
The next requirements are based on the limitations presented by this device and the 
complexity of the application.  The device is underactuated, it has no actuated degrees of 
freedom outside the sagittal plane and has very limited sensing.  The application itself is so 
complex that had either complete sensor information or complete actuation been available, it 
is not entirely clear what method should be used to utilize these new resources.  To counter 
this, the control presented here will utilize the upper extremity actuation of the user to control 
the overall balance of the device.  The adaptability of the human body in the area of walking is 
unrivaled.  By allowing the user to maintain a source of input through their arms, the controller 
can take advantage of the users superior planning and adaptability. 
With this in mind, the final requirement is that the control outputs must be repeatable 
and reliable so the user can know what to expect from the device, and pilot it in a way that they 
can use it effectively.  As presented, this application has the strange property where the 
controller will never be capable of guaranteeing the successful completion of the large scale 
goal of stable walking.  The simplest examples are a user choosing to actively knock themselves 
over or lift their feet off the ground with their forearm crutches.  Because, of this the controller 
can only strive to perform classical closed loop control on the behavior of the individual joint 
and then have them to behave in a way that the user can learn to work with. 
4.1  CONTROL ARCHITECTURE 
The basic control structure was selected to account for the interaction of the human 
with  the  system.    Multiple  stages  of  control  are  used  to  accomplish  the  different  tasks 
presented to the controller, as seen in Figure 4.1.  This structure allows the deliverable of each 
22 
 
----------------stage of control to be well defined so that the controller is extremely flexible for application to 
new maneuvers and clear when evaluating functionality. 
 
 
Figure 4.1 – Overall Controller Architecture 
The first stage of control is the Human Machine Interface, which will be referred to as 
HMI from this point forward.  This stage of control is specifically tasked with determining the 
intended  maneuver  of  the  user  based  on  the  provided  inputs.    For  example,  the  HMI  is 
responsible for identifying when the user intends to transition from sitting to standing and then 
to walking.  The HMI is generally viewed as a discrete stage of control due to the fact that the 
intent  classification  has  a  discrete  allowable  domain  depending  on  what  maneuvers  are 
supported by the system.  More information about the function of the HMI methods used in 
this device are provided later in this section. 
The second stage is the trajectory generator, which based on the intended maneuver as 
reported by the HMI along with the current sensor feedback from the device determines what 
the device should do to accomplish the intended maneuver.  For this machine, the output of 
this stage of control is a set of desired joint angles for each of the controlled joints of the 
system.  It is also possible for the trajectory generator to result in a set of desired joint torques 
but in this machine the ability to control to a desired torque is not possible due to the lack of 
sensors.  This is the first stage of control that operates continuously and provides most of the 
design opportunities for the continuous control because it does not fit well into many classical 
control methods.  This is the section of the controller that is the primary research focus of this 
document and more information regarding how this is handled is provided below. 
The  final  stage  of  control  is  the  low  level  controller,  which  generates  the  current 
command for the individual joints to reach the desired motion resulting from the trajectory 
generation.  This stage is a more classical control method as it includes the closed loop tracking 
of a desired joint angle by adjusting the commanded current to the motor at the joint.  This 
controller  can  easily  be  modeled  as  a  continuous  time  single  input  single  output  (SISO) 
23 
 
----------------controller where other factors are viewed as disturbances.  More information regarding this 
stage of the controller is available later in the section. 
4.2  HUMAN MACHINE INTERFACE 
The HMI attempts to convert external inputs either through the HMI sensors discussed 
in Section 2.3 of this dissertation or a Graphical User Interface (GUI) to select the intended 
maneuver for the user.  To accommodate the discrete dynamic conditions present during 
bipedal walking, the HMI uses a finite state machine to indicate the intended option of a series 
of maneuvers.  The high level maneuvers that the HMI can move between are currently as 
follows: Seated, Stand Up, Standing, Walking, Turning and Sit Down.  The high level of the state 
machine is shown in Figure 4.2. 
 
Figure 4.2 – HMI Finite State Machine for Available Maneuvers 
In some cases the HMI also behaves to move through the phases of a specific maneuver.  
The most prevalent maneuver where this is the case is in walking.  Here the HMI is used to 
indicate the user’s intent to take each individual step.  This is important because while some 
maneuvers have very definite beginnings and ends like standing up, repetitive maneuvers such 
as walking required continued involvement by the user for the device to know to continue the 
action.  For example, walking is split into three different phases within the HMI which include 
an initial state where the subject stands still as well as right and left step phases.  It is important 
to note, that while additional phases exist to execute the walking action, these three states are 
the ones that identify the intent of the user for the controller to act on.  The state machine 
showing the phases of the walking maneuver can be seen in Figure 4.3. 
 
 
Figure 4.3 – Walking Maneuver HMI State Machine 
 
24 
 
----------------The guards in these state machines are set based on the mode of operation of the HMI.  
The first mode uses the GUI to allow the user or a therapist to move through maneuvers as well 
as the individual phases of those maneuvers.  This simple mode relies entirely on input from the 
GUI  for  every  transition.    The  advanced  mode,  which  is  based  on  the  research  of  Katie 
Strausser, uses the input of the HMI sensors to create these guards.  For example, to transition 
from the right foot step phase to the left foot step phase the advanced HMI looks to see that 
the right crutch has progressed forward through the arm angle sensor and that the crutch has 
been loaded.  If these conditions are met than the HMI identifies that the user has moved their 
crutch forward and shifted weight onto that forward crutch thus intending to step forward.  In 
addition to these guards, some foot sensor information is evaluated to identify that the feet are 
correctly loaded to allow for a safe step.  Similar transitions are provided for in the advanced 
HMI throughout the finite state machine to allow for natural, robust and safe transitioning 
between states. 
The primary benefit provided by the advanced state machine is that instead of requiring 
direct input by the user, it has the potential to view the entire posture and motion of the user 
to determine intent.  In turn it allows the option to identify the user’s intent by perceiving the 
small  motions  that  the  user  makes  naturally  when  trying  to  accomplish  that  motion.  
Potentially,  the  advanced  HMI  can  provide  a  safer  user  experience  by  identifying  and 
preventing  false  state  triggers  that  could  be  caused  even  in  the  simple  mode  due  to  an 
inadvertent button press.  By looking at the entire pose of the subject, the HMI can identify 
postures that do not match with the selected intent of the user and then ask for clarification or 
completely block them if they are deemed unsafe.  Based on these potential rewards provided 
by the advanced HMI at this stage of the controller, it is still an active area of research. 
4.3  LOW LEVEL CONTROL 
The task of the low level controller is to generate the desired motor current necessary 
to get the individual joints to complete their desired actions.  The low level controller is 
currently applied independently to each of the four joints resulting in a single input single 
output (SISO) control problem.  The block diagram for how the low level controller operates is 
shown in Figure 4.4.  It is worth noting that the output of the controller is the desired motor 
current because, as shown in Figure 4.5, the plant dynamics include the dynamics added to the 
system by the motor drive.  The motor drive has an internal PI controller that is used to track 
the desired motor current and supply it to the motors. 
 
 
Figure 4.4 – Block Diagram for Arbitrary SISO Low Level Controller 
25 
 
---------------- 
Figure 4.5 – Detail of Plant Dynamics in Low Level Controller 
One freedom that this low level control structure provides is to set up many different 
low level controllers that can be implemented at a specific joint.  The two components that can 
be manipulated are which state variable to track and which controller to implement.  At the hip 
joint for example, the low level controller can close the loop on the relative joint angle between 
the thigh and the torso as well as the absolute torso or absolute thigh angles.  This structure 
also allows for the tracking of a desired joint torque in the future when additional sensors are 
added to provide feedback on the actual joint torque.  The controller typically implemented is a 
version of a PID controller where depending on where it is applied the gains are scheduled to 
provide the desired feel to the user.  The scheduled gains are used to account for significant 
changes in system dynamics such as a leg moving from stance to swing or to get different 
behavior such as the stiff control desired while standing still as compared to the smooth soft 
control provided through the gait. 
The performance of this low level controller has been adequate for the requirements of 
the application.  In standard operating conditions, these controllers can be tuned to maintain 
tracking errors of around ±3 degrees.  A representative case is shown in Figure 4.6, where the 
tracking error of the knee joint to a sinusoidal desired angle using a stiff PD controller with the 
foot off the ground. 
 
60  
Actual
55 Desired
50
°] 45
e [
gl
n 40
A
nt 
oi 35
J
30
25
20 
0 0.5 1 1.5 2 2.5 3
Time [s]  
Figure 4.6 – Low Level Controller Tracking Results for Knee Angle 
26 
 
----------------It is important to note that while these controllers can be more aggressively tuned in 
order  to  minimize  the  tracking  error,  no  realistic  improvement  in  performance  would  be 
achieved for the actual system.  The goal of the controller is to move the subject’s leg to the 
desired joint angles, and a number of sources of error lie between the controlled exoskeleton 
joint and the user’s joint.  Error from the coupling of the user’s leg to the device leg and sagittal 
plane flexing of the exoskeleton leg due to the limited mechanical stiffness are the primary 
contributors.  On the actual system these sources of error can easily result in errors of at least 
±2 degrees.  In turn, better tracking would do little to improve the behavior because there is no 
sensing available of these errors that are after the device joint. 
If in the future improvements to the low level controller were desired due to tighter 
required specifications or a new maneuver which demonstrates degraded performance from 
the current implementation, two improvements could be applied.  The first improvement takes 
advantage of the fact that while the current technique does not require a model to gain 
tracking, some information is known about the required performance of the joint that can allow 
for gravity compensation.  Gravity compensation is not a new concept as the benefits of it have 
been explored in previous research [59, 60] and have also been implemented in other bipedal 
gait devices [60, 61].  The primary disturbances that this joint must overcome on the swing leg 
are the result of gravity on the mass of the machine and users leg.  By adding this simple model 
into the system using positive feedback, as shown in Figure 4.7, the low level controller is only 
responsible for overcoming the error between the actual load needed and the modeled load 
unlike  before  where  it  was  responsible  for  everything  at  the  joint.    Because  the  gravity 
compensation is implemented through positive feedback, the closed loop dynamics of the 
resulting plant with the compensation will change and in turn may require the gains of the low 
level controller to be tuned again to provide stability.  
 
Figure 4.7 – Improved Low Level Controller with Positive Feedback Gravity Compensation 
The other potential improvement is to develop a model of the system and implement a 
multi input multi output (MIMO) controller that addressed each of the joints together as 
opposed to the independent behavior of the implemented controller.  While the SISO system 
controller is rather effective, the dynamics of the system are coupled as discussed in Section 3.  
The most obvious location to evaluate this is the thigh, which directly is effected by the torque 
of both the knee and the hip.  In turn, if the hip is trying to control the absolute angle of the 
thigh and the knee is exerting a torque on the thigh as well, the resulting torque on the thigh 
could balance and lead to no motion.  While this result is not a significant failure, the torque on 
the hip will still act on the torso and most likely result in an undesirable motion for the user.  A 
MIMO solution utilizing a model will perform better in these conditions because it would 
inherently account for the coupling of the exoskeleton states. 
27 
 
----------------4.4  TRAJECTORY GENERATION 
The  controller  levels  discussed  in  detail  up  to  this  point  accomplish  the  tasks  of 
determining the user’s intent and then controlling the joints to perform as requested.  The 
trajectory generation stage of the controller is used to bridge the gap between these two 
stages  by  determining  the  desired  joint  actions  based  on  the  intended  maneuver.    To 
accomplish this task, the trajectory generation uses a finite state machine to move through the 
different phase of operation for the intended maneuver.  By using the finite state machine to 
determine the phase of operation, specific trajectories can then be developed in continuous 
time to achieve the desired machine behavior.  To explain the trajectory generation process, 
this section will detail the complete finite state machine and specific trajectories generated 
within them for the walking cycle. 
The walking finite state machine is the same as that provided by the HMI with the 
addition of two phases to delineate the single and double stance phases of the gait, as shown in 
Figure 4.8.  The trajectories generated are from the perspective of the right leg where the left 
leg is 180 degrees out of phase at all times. 
 
Figure 4.8 – Basic Walking Finite State Machine for Trajectory Generation 
Swing Phase 
The first phase the right leg enters is the Swing phase.  During the swing phase, the 
desired motion of the leg is for the foot to pick up off the ground, progress forward and then 
return to the ground with a heel strike.  Swing executes in half of the user selected step time. 
The individual joint angle trajectories for both the hip and knee joints as a function of 
time are precalculated and stored in a look up table for use during the control cycle.  The design 
of these trajectories has a significant impact on the behavior of the system while in the walking 
phase.  One potential design method is to use the joint angle trajectories of an unimpaired gait 
and play them back while the subjects are walking.  In application, this method does not work 
because of a number of differences that exist between an unimpaired gait and a gait in the 
exoskeleton.  One of those differences is that an unimpaired gait has powered ankle flexion to 
aid in toe clearance while the exoskeleton ankle is sprung to its neutral position of 5 degrees 
dorsiflexion.  The other primary difference is the small deviations that are possible from the 
28 
 
----------------desired position due to low mechanical stiffness, imperfect joint angle tracking and imperfect 
coupling between the user and the machine.  These reasons all point to the implemented 
trajectories requiring more toe clearance than standard healthy walking to provide some buffer 
room to allow for these issues to exist while still creating sufficient toe clearance for the user in 
the device. 
The final joint trajectories that were selected are modified to provide additional toe 
clearance for the machine foot through the swing process.  In order to provide the additional 
toe clearance required, the peak knee flexion increased to 76 degrees and the peak hip flexion 
increased to 49 degrees.  These increases in the range of motion used in normal walking have a 
significant effect on the gait in that they limit the speed at which an individual step can be 
taken.  In order to keep the joint angle velocities at safe levels for the joints of the user, the 
minimum step time most users can comfortable handle is 2 seconds which is about twice the 
step time of an unimpaired gait [47].  The final joint angle trajectories and their comparison to 
unimpaired joint angle trajectories can be seen in Figure 4.9. 
80  
Precalculated Hip
70 Precalculated Knee
Unimpaired Hip
60 Unimpaired Knee
50
°]
e [
gl 40
n
A
nt  30
oi
J
20
10
0
-10 
50 55 60 65 70 75 80 85 90 95 100
Percent Gait [%]  
Figure 4.9 – Precalculated Swing Phase Trajectories Compared to Unimpaired Gait 
The only other task of this phase is to make sure that the trajectories are zero order 
continuous at all times.  This is only an issue at the beginning of the phase where the joint 
angles coming into the swing phase may not match the initial angles of the precalculated joint 
angle trajectories.  To accommodate this, the actual trajectories use a linear blend to move 
smoothly from the initial joint angle references entering the phase to the precalculated ones 
over a set period of time.  The behavior of this blend can be seen in Figure 4.10 and is discussed 
in detail in the appendix in Section 11. 
A final modification to the trajectories is the application of a user selectable desired 
knee angle at heel strike.  The selectable value is varied between 0 and 15 degrees to make 
weight transfer during early double stance easier for the subject, where it gets easier as the 
29 
 
----------------angle is increased.  This is because by bending the leading knee in the first double stance phase 
of the gait it shortens the front leg of the double stance posture where the user can more easily 
move forward over that leg than fall back over the trailing leg.  This angle is added to the knee 
angle with another linear blend from the peak of knee flexion to the end of the step.  This 
behavior is also shown in Figure 4.10. 
80  
Blended Hip
70 Blended Knee
Precalculated Hip
60 Precalculated Knee
50
°]
e [
gl 40
n
A
nt  30
oi
J
20
10
0
-10 
50 55 60 65 70 75 80 85 90 95 100
Percent Gait [%]
 
Figure 4.10 – Linear Blending of Precalculated Swing Phase Trajectories for Continuity 
At the end of this walking phase the joints hold their final angles until the foot comes in 
contact with the ground.  At that time the phase transitions to the first double stance phase of 
the state machine. 
1st Double Stance 
In the first double stance phase of walking, the knee needs to prepare itself to take the 
load of the body through the single stance phase.  To do this the leg needs get to a user 
selected bend angle that is close enough to standing to allow the user to shift their weight onto 
that leg.  The knee bend angle is typically set between 0 and 15 degrees.  With the knee flexed, 
it is easier for the user to transfer their weight onto their forward leg.  Typically, the knee is 
position controlled to track the desired joint angle throughout this entire phase, however, if a 
low knee bend angle is specified where the joint angle can reach within 2 degrees of full 
extension, then the brake will trigger and lock the joint. 
At the hip, the joint stops putting out torque in order to allow the user to shift their 
body weight forward over the forward leg of the double stance phase.  Ideally, this would be 
accomplished by allowing the joint to maintain a zero torque desired output, but because there 
is no sensing that allows for accurate torque estimation at the joint, simply zeroing the torque 
output of the motor was found to be a sufficient alternative.  The only errors that this results in, 
is requiring the forward momentum of the user to overcome any friction present at the joint 
30 
 
----------------during this motion.  The only controlled motion at the hip are the safety limits used to restrict 
the free hip from progressing significantly beyond the initial angle.  Thus if the joint is bent to 
more than ±15 degrees from the initial hip angle for this double stance phase, it is position 
controlled to prevent a runaway situation.  This is only to prevent a specific failure scenario and 
is not in play during normal operation of the device. 
After the user has successfully transferred their weight onto the swing leg, the HMI 
triggers the advance to the next state.  At this point the leg transitions to single stance. 
Single Stance 
In single stance the leg is responsible for supporting the weight of the body as high as 
possible to allow for toe clearance of the swing leg and progress the body forward to allow for 
an acceptable step.  To get the hips as high as possible the knee of the stance leg is position 
controlled through an extension to 0 degrees at which time the joint is locked with the use of 
the brake that is on the joint.  The trajectory for the controlled extension is created by using a 
linear blend from the initial knee angle to 0 degrees over 30% of the user selected cycle time. 
To progress the body forward, the hip undergoes a controlled extension to a user 
selected desired hip angle.  This controlled extension also provides some propulsive assistance 
to the user during the walking cycle.  The user selected hip angle is typically set between 5 and 
10 degrees to provide sufficient hip extension at the end of single stance.  The trajectory used 
for the hip is generated with the use of a linear blend from the initial single stance hip angle to 
the desired extension angle over the 50% of the user selected cycle time.  The behavior of both 
of these joints through single stance can be seen in Figure 4.11. 
15  
Blended Hip
Blended Knee
10
°]
e [
gl
n 5
A
nt 
oi
J
0
-5 
0 5 10 15 20 25 30 35 40 45 50
Percent Gait [%]  
Figure 4.11 – Typical Single Stance Joint Angle Trajectories 
The ending angles of this phase are held until the user’s foot contacts the ground and 
the state machine transfers to the second double stance phase of the gait. 
31 
 
----------------2nd Double Stance 
The purpose of the second double stance phase in this gait is to allow the user to shift 
their weight to the front foot.  To do this, the knee remains locked.  In the event that the state 
transferred due to foot contact prior to the knee locking, the knee joint is linear blended from 
the initial knee angle to 0 degrees where it is subsequently locked just as it was in single stance.  
The hip is position controlled to hold the initial hip angle coming into this phase.  This allows 
the user a known body posture to position while awaiting the next HMI trigger.   
The base function for each of the walking phases discussed above is actually quite 
simple.  The majority of the complexity found in this state machine involved handling the errant 
cases that the state machine may encounter.  After adding all of these handling conditions as 
discussed before to the state machine, it grows to a quite active state machine as shown in 
Figure 4.12.  The main step provided by this state machine centered approach to trajectory 
generation is that while it does not provide optimal control for the entire walking cycle, it 
provides a functioning base that allows each of the functions of a normal gait to be carried out 
with adequate tolerance for the many possible inputs from the user.  By having this structure, 
the function of any one area can be independently evaluated and applied to a real user as will 
be done in the coming sections of this dissertation. 
Swing Phase 1stDouble Stance
Position  Position 
Controlled  Initial Blend Controlled Knee 
Knee Swing Straighten
Position 
Controlled  Free Hip Locked 
Hip Swing Knee
Initial Blend Initial Blend Syncronized 
Initial Blend Initial Blend HMI Trigger
Position  Position 
Controlled  Controlled 
Hip Hold Hip Stance
Locked  Locked 
Knee Knee
Position  Position 
Controlled Knee  Initial Blend Controlled Knee 
Straighten Straighten
2ndDouble Stance Single Stance
Syncronized Foot 
  Contact Trigger  
Figure 4.12 – Complete Walking State Machine 
Synchronized trigger indicates that hip and knee advance states at same time 
It is important to note that all trajectories on the device are generated in a similar 
manner.  While only the trajectory generation state machine for walking was provided here, 
similar state machines exist for the standing up and sitting down maneuvers currently handled 
by the system.  This in turn, can be applied to many other types of maneuvers that will be 
developed on this device such as turning, and ascending or descending stairs. 
32 
 
----------------5  ACTIVE SWING PHASE TRAJECTORY GENERATION 
The swing leg joint trajectories serve as one of the most significant aspects of the overall 
performance of the gait.  The currently discussed method for generating these desired knee 
and hip position trajectories involves generating an offline calculation of the trajectories and 
then playing them back as a function of time through the step as detailed in Section 4.  While 
this has proven to be a reasonably reliable method for developing these trajectories, it presents 
some significant issues that limit its long term application. 
First, this walk generates a conservative ground clearance profile in order to guarantee 
that the foot reliably clears the ground throughout a range of different poses.  In turn, because 
the trajectories create a foot profile that successfully clears the ground for a subject leaning 
significantly forward, it leads to excessive toe clearance for subjects who have either learned to 
or been coached to walk more upright.  With the goal of the device being to generate a 
repeatable and reliable gait for a wide variety of patients, this is an undesirable result.  Second, 
the simple trajectory generation method makes the assumption that all steps are the same.  
This is not the case for most steps and especially not for the extreme cases such as first and last 
steps which only require a half step.  This results in strange steps that look unnatural when the 
precalculated gait trajectories are significantly different from what the joints should actually be 
doing. 
Third, the previously presented trajectory generation technique has no clear method for 
modifying the gait actively.  Typically during testing the therapist or user may want to adjust the 
step length or independently adjust the toe clearance height that the step is attempting to 
reach.  Because both of these are sagittal plane Cartesian constraints it is not entirely clear how 
to reflect these desired modifications onto the joint space trajectories.  Finally, when the 
desired joint trajectories are blended to account for initial joint positions, it is unclear what 
motion is created for the foot in the sagittal plane by the use of the smoothed joint space 
trajectories.  In some cases, smooth joint space trajectories can lead to undesirable results such 
as the toe clearing the ground at very different heights throughout the step or in some cases 
not at all. 
This method seeks to fill the void and develop an active trajectory generator that will 
calculate the desired joint trajectories throughout the step.  This method will use feedback 
from  the  joint  kinematics  and device pose  in combination  with  Cartesian  and  joint  space 
constraints to develop joint trajectories leading to the desired foot motion.  This method will be 
developed to improve each of the discussed issues with the previous technique. 
5.1  ACTIVE TRAJECTORY GENERATION STRUCTURE 
Throughout the gait the leg must accomplish a series of different tasks that can be 
isolated  from  the  other  states  of  the  swing  phase.    The  structure  used  to  generate  the 
trajectories takes advantage of this by using a finite state machine to isolate these specific 
33 
 
----------------tasks.  This, as with the larger trajectory generation state machine, allows the controller to 
focus on completing one specific task at a time.  The states present in the active trajectory 
generation state machine are Pre-Swing, Toe Clearance, Toe Extend, Heel Extend, Heel Plant 
and Toe Plant and are shown in Figure 5.1.  The guards for the individual states and the specific 
methods  used  to  generate  these  trajectories  are  discussed  later  in  this  section  of  this 
dissertation. 
 
Figure 5.1 – Active Swing Phase Trajectory Generation State Machine 
The primary unknown throughout this calculation is location of the hips relative to the 
stance foot.  In a simplified system where the hip joint position was either fixed or defined 
throughout the entire step the desired foot path for the step along with the joint trajectories 
could be fully defined based off the initial conditions.  Because this is not the case, however, 
the desired joint trajectories can be recomputed every control cycle based on the current 
estimate of the hip location.  In all states, the individual joint angles are calculated using the 
swing leg geometry and the current hip location estimate.  As shown in Figure 5.2, for both the 
calculation  of  heel  and  toe  locations  the  joint  angles  are  completely  defined  when  two 
parameters are present.  This property is used to calculate the desired joint angles by varying 
which two parameters are provided based on which state in the state machine you are in. 
 
(A)          (B)          (C)   
Figure 5.2 – Leg Geometry for Active Trajectory Calculations 
Leg geometry as used in each state of the active method to calculate the desired joint references based 
on having 2 of the 4 constraints (D , D , θ , θ ) (A Heel Centered Geometry Diagram,                                  
x y Th K
(B) Toe Centered Geometry Diagram, (C) Lower Leg Geometry Close-up 
Before the individual states are discussed, there are a few concepts that are important 
to understand. First, the goal of the active trajectory generator is to create a step of a user 
34 
 
----------------selected step length and clearance height.  Both of these values are selectable by the user on 
the GUI where the clearance height is the desired number of inches of toe clearance for the 
step and the step length is the desired length from toe to toe in the resulting double stance 
phase.  It is also important to note that just as in the simple trajectory generation method the 
step will attempt to complete in 50% of the user selected step time. 
Second,  this  active  trajectory  generator  is  meant  to  replace  the  simple  method 
discussed in the previous section within the overall state machine.  In turn, the active method is 
only generating trajectories for the swing leg.  The trajectories are intended to clear the ground 
and then reach the desired step length in the desired step time despite the behavior of the 
stance leg and torso of the user.  Because the stance leg and torso is controlled by this input of 
the user, it can be expected that the trajectories will be different for each step even if all the 
user selectable settings are the same. 
5.2  STATE BEHAVIOR AND DESCRIPTIONS 
Pre-Swing 
The first state of the active method is the Pre-Swing state.  Coming into the swing state 
the swing leg typically has a fully extended knee which leads to the toe of the foot being 
located in front of the user’s thigh.  This is important because in order to arbitrarily place the 
toe into a desired Cartesian position as is needed to complete the step, the toe must be moved 
through the geometric singularity caused by the thigh and the toe as shown in Figure 5.3.  For 
this reason, the Pre-Swing phase is responsible for flexing the knee to move the toe through the 
singular position. 
 
Figure 5.3 – Geometric Singularity Entering Swing Phase 
This state takes advantage of one characteristic of an unimpaired gait, where the knee 
flexes is a sinusoidal motion up to the peak knee flexion angle.  The first aspect is estimating the 
peak knee flexion angle for the swing leg.  This estimation is made by calculating the hip to toe 
length needed for the toe to pass directly under the hip with the desired toe clearance because 
this is going to be the minimum available clearance length.  The estimation is completed once 
at the beginning of the state.  The knee angle trajectory is then calculated as a sinusoidal 
function from the initial angle to the peak flexion estimate with a half period of 50% of the 
desired swing time. 
35 
 
----------------At this time the hip trajectory is calculated to maintain the absolute angle between the 
hip and toe throughout the process.  Another potential way of making this calculation would be 
to use the hip to maintain the Cartesian X coordinate of the toe position to minimize the 
relative motion between the foot and the ground.  In application, however, it was evident that 
because no angle measurement is available for the ankle, the estimate of the toe X position in 
this state when the foot is contacting the ground and the ankle is not at its neutral position was 
so poor that it actually increased relative motion.  The portion of the trajectory generated for a 
representative step through this state and the resulting body posture is shown in Figure 5.4 and 
Figure 5.5. 
 
70 Swing Thigh
Swing Knee
60
50
°] 40
e [
gl 30
n
A
nt  20
oi
J
10
0
-10
-20 
50 55 60 65 70 75 80 85 90 95 100
Percent Gait [%]  
Figure 5.4 – Pre-Swing State Generated Joint Reference Trajectories 
 
35 Complete Toe Profile
Initial State Posture
Ending State Posture
30
n]
e [i 25
at
n
di
or 20
o
C
Y 
n  15
a
si
rte 10
a
C
5
0
 
-15 -10 -5 0 5 10 15 20 25 30
Cartesian X Coordinate [in]  
Figure 5.5 – Pre-Swing State Resulting Posture 
36 
 
----------------The guard for progressing to the next state is when the leg has progressed past the 
singularity position with a small dead band to ensure the toe is sufficiently beyond.  The dead 
band used is an absolute thigh angle 10 degrees beyond the absolute hip to toe angle.   
Toe Clearance 
The next state in the active swing method is the toe clearance state.  This state is 
responsible for progressing the foot forward towards the desired plant location and clearing the 
ground with an allowable clearance height.  This is completed by defining the desired relative X 
and Y coordinates for the toe relative to the hip and using the leg geometry to compute the 
joint angles. 
In order to define the desired X coordinate, a sinusoidal function is used ranging from 
the  current  relative  toe  X  position  to  the  estimated  ending  relative  X  position  with  a 
predetermined period.  The explicit equation for the calculation of the desired X coordinate at a 
specific time can be seen in Equation 5.1. 
 
6
-./ = .5(cid:2)-.2 −-.34.(cid:4)cos5 (cid:2)8/ −82(cid:4)9+.5(cid:2)-.2 +-.34.(cid:4)
0.95−82 Equation 5.1 
where 
  Initial Relative X Coordinate for State 
-.2  Estimate of Maximum Relative X Coordinate for Entire Gait 
-. 34. Initial Cycle Percentage for State 
82  Cycle Percentage at Time i for State 
8/
It is extremely important that the desired X position is specified relative to the hip and 
not in absolute coordinates.  Because the X position of the hip is not known for times in the 
future, it is possible that the hip progresses forward faster than the desired toe coordinate 
resulting in rapid extensions of the knee through the beginning of this state.  Alternatively, by 
specifying desired toe coordinates relative to the hip the length between the hip and desired 
toe position is bounded and smooth, eliminating the potential for errors based on out of phase 
motion between the hip and desired toe positions. 
The toe’s Y coordinate is intended to get up to the user selected clearance height and 
remain there.  In order to get the toe up to this height in a smooth fashion, the desired toe 
height is blended from the initial position and velocity to the clearance height using a first order 
continuous blend.  More information regarding the specifics of the implementation of this 
blend can be found in the appendix in Section 11.  The blend is carried out over 15% of the 
swing time so that the foot can quickly get off the ground to allow for the swing phase to carry 
out. 
37 
 
----------------Once the desired X and Y coordinates are defined, the desired joint angles are calculated 
using the leg geometry.  The resulting joint trajectories and body posture can be seen in Figure 
5.6 and Figure 5.7 respectively. 
 
70 Swing Thigh
Swing Knee
60
50
°] 40
e [
gl 30
n
A
nt  20
oi
J
10
0
-10
-20 
50 55 60 65 70 75 80 85 90 95 100
Percent Gait [%]  
Figure 5.6 – Toe Clearance State Generated Joint Reference Trajectories 
 
35 Complete Toe Profile
Initial State Posture
Ending State Posture
30
n]
e [i 25
at
n
di
or 20
o
C
Y 
15
n 
a
si
rte 10
a
C
5
0
 
-15 -10 -5 0 5 10 15 20 25 30
Cartesian X Coordinate [in]  
Figure 5.7 – Toe Clearance State Resulting Posture 
The guard present for leaving this state and progressing to toe extend is reached when 
the toe has progressed to some dead band in front of the hip which in this case was set to 3”.  
The reason for progressing at this time is that after the toe passes the hip which is the 
maximum knee flexion location, the constraints on the motion of the system are no longer the 
desired X and Y coordinates of the toe.  At this position in the motion the primary concern is 
38 
 
----------------that the knee extends at a reasonable speed so the user can prepare for stance.  So if the 
anticipated desired toe X resulted in a knee angle that extended extremely slow or even 
paused, the desired behavior would be to compromise on the step time and toe X progression 
in order to have a step that felt and appeared more natural to the user. 
Toe Extend 
Toe  extend  is  the  next  state  in  the  active  method  state  machine  and  is  primarily 
responsible for extending the knee at a reasonable rate while maintaining the user specified 
clearance height with the toe.  The calculation is made by determining the desired knee angle 
and  toe  Y  position  relative  to  the  hip  and  then  using  leg  geometry  to  calculate  the 
corresponding hip joint reference angle. 
The first aspect to determining the desired knee angle is making an estimate of the 
ending knee angle based on the current pose of the device.  One aspect of this estimation is 
that no guess has yet been made as to whether ground contact was going to end in a heel strike 
or a toe strike.  To accurately estimate the ending knee angle a crude estimation is made, but 
there would be significant benefit in knowing more accurately the ending condition of the foot.  
The estimation used in this implementation is that if the linear distance between the hip and 
the ending toe position is greater than the maximum possible heel to toe length then the 
ending knee angle is estimated as if heel strike will occur and otherwise it is assumed toe strike 
will occur.  The ending knee angle is then estimated based on the leg geometry.  It is important 
to note that even if it is estimated that the ending ground contact condition will be a heel 
strike, no action is taken to position the heel such that it will contact the ground.  This is 
because this estimation is so poor and made so early in the gait that the odds of it being 
accurate are very slim.  So while the ending knee angle is estimated differently, the state still 
acts to maintain the toe at the clearance height and relies on future states make the decision to 
change the action.  This will be discussed more with the guards of this state along with the heel 
extend state. 
The next aspect to determining the ending knee angle is to estimate the desired time 
the knee angle should extend over.  This is present to protect against the knee angle extending 
too slowly or pausing as discussed previously.  To accomplish this, the desired ending time was 
selected based on how far the knee was expected to extend between the current angle and the 
estimated ending knee angle.  This allows the active method to compromise on the desired step 
time and take a slightly faster than normal step in order to maintain normal motion at the knee 
joint.  Once both the ending time and the ending knee angle have been estimated the desired 
knee angle can be computed using a first order continuous blend as discussed in the appendix 
in Section 11. 
The desired relative toe Y coordinate is selected based on the user specified clearance 
height and the reference hip angle is calculated based on the resulting leg geometry.  The 
resulting joint trajectories and posture are shown in Figure 5.8 and Figure 5.9 respectively. 
39 
 
---------------- 
70 Swing Thigh
Swing Knee
60
50
°] 40
e [
gl 30
n
A
nt  20
oi
J
10
0
-10
-20 
50 55 60 65 70 75 80 85 90 95 100
Percent Gait [%]  
Figure 5.8 – Toe Extend State Generated Joint Reference Trajectories 
 
35 Complete Toe Profile
Initial State Posture
Ending State Posture
30
n]
e [i 25
at
n
di
or 20
o
C
Y 
n  15
a
si
rte 10
a
C
5
0
 
-15 -10 -5 0 5 10 15 20 25 30
Cartesian X Coordinate [in]  
Figure 5.9 - Toe Extend State Resulting Posture 
The guards for this state allow for three different transitions.  The first is the transition 
to heel extend which happens when the heel is found to be approaching the user selected 
clearance  height  at  a  rate  greater  than  a  predetermined  threshold.    If  this  transition  is 
triggered, the actions change to reference the heel position in preparation of an assumed heel 
strike contact.  This transition is the first available transition that allows the system to begin 
preparing for a heel strike and in turn is a conservative guard.  This transition only catches the 
very clear heel strike conditions because the decision is being made earlier in the gait cycle. 
40 
 
----------------The next guards available to this state trigger when the toe progresses to within some 
dead band of the desired ending X coordinate, where the dead band as implemented is 3”.  At 
this time the same crude estimation is used that was for the ending knee angle.  If the length 
from the hip to the desired ending toe location is greater the maximum hip to toe length then 
the system transitions to heel plant and otherwise it transitions to toe plant.  This is the last 
point at which the active method can transition to preparing for a heel strike ground contact. 
Heel Extend 
The next state in the active toe trajectory state machine is the heel extend state.  This 
state is responsible for continuing to extend the knee while keeping the heel at or above the 
user selected clearance height.  The function of the state is very similar to that of the toe 
extend state but using the heel as the primary focus.  As discussed earlier, this state handles the 
poses that meet the conditions of a very conservative guard.  Due to this, the state is typically 
very  short  with  complete  subjects  because  they  generally  walk  leaned  over  farther  than 
incomplete or unaffected counterparts.  Despite this the state is extremely important to the 
function of the active method, because it allows the method to emulate the behavior of an 
unaffected gait by allowing the foot to continue to extend while maintaining proper clearance 
at the heel. 
Because the knee angle is calculated exactly as in the toe extend, except for the ending 
knee angle always being calculated in reference to the heel, the primary behavioral portion of 
this state is establishing the desired relative Y  coordinate.   Entering the state the heel is above 
the clearance height and moving towards as dictated by the guard coming into the state.  
Because of this, the heel Y coordinate is set with a first order continuous blend from the initial 
conditions entering the state to the desired clearance height.  At that point with the desired 
relative Y coordinate and the desired knee angle, the resulting hip joint reference angle can be 
calculated using the leg geometry. 
The guard for this state is if the heel reaches within 3 inches of the desired heel plant x 
coordinate which triggers a transition to the heel plant state.  The resulting joint trajectories 
and the posture are shown in Figure 5.10 and Figure 5.11 respectively. 
41 
 
---------------- 
70 Swing Thigh
Swing Knee
60
50
°] 40
e [
gl 30
n
A
nt  20
oi
J
10
0
-10
-20 
50 55 60 65 70 75 80 85 90 95 100
Percent Gait [%]  
Figure 5.10 – Heel Extend State Generated Joint Reference Trajectories 
 
35 Complete Toe Profile
Initial State Posture
Ending State Posture
30
n]
e [i 25
at
n
di
or 20
o
C
Y 
n  15
a
si
rte 10
a
C
5
0
 
-15 -10 -5 0 5 10 15 20 25 30
Cartesian X Coordinate [in]  
Figure 5.11 – Heel Extend State Resulting Posture 
Heel Plant 
The next state in the swing phase is the heel plant state.  This state is responsible for 
extending the knee as much as it can without interfering with the ground and moving the heel 
to the correct step length.  This is accomplished using the desired knee angle and the desired 
heel X coordinate relative to the hip as the constraints for the leg geometry to calculate the 
reference hip angle. 
42 
 
----------------The knee is extended just as it was in the heel extend state.  The hip is calculated to 
maintain a desired heel x coordinate and move it to the x coordinate needed to meet the 
intended step length.  This is done with a first order blend from the initial heel x coordinate and 
x velocity to the desired ending coordinate.  The resulting joint angle trajectories and posture 
due to the heel plant state are shown in Figure 5.12 and Figure 5.13 respectively. 
 
70 Swing Thigh
Swing Knee
60
50
°] 40
e [
gl 30
n
A
nt  20
oi
J
10
0
-10
-20 
50 55 60 65 70 75 80 85 90 95 100
Percent Gait [%]  
Figure 5.12 – Heel Plant State Generated Joint Reference Trajectories 
 
35 Complete Toe Profile
Initial State Posture
30 Ending State Posture
n]
e [i 25
at
n
di
or 20
o
C
Y 
n  15
a
si
rte 10
a
C
5
0
 
-15 -10 -5 0 5 10 15 20 25 30
Cartesian X Coordinate [in]  
Figure 5.13 – Heel Plant State Resulting Posture 
The only guard for transitioning out of the state is the foot contacting the ground.  At 
this time the overall walking state machine will transfer out of the swing phase and into the 
first double stance phase.  In the event that the foot does not hit the ground at the intended 
43 
 
----------------time, the knee joint will hold its calculated end angle and the hip will continue to maintain the 
desired step length. 
Toe Plant 
The final state in the active swing phase trajectory generation method is the toe plant 
state.  This state operates exactly as the help plant state, but instead of moving the heel to the 
desired end x coordinate it controls the toe to its desired end coordinate.  This state is an 
interesting case because it should only execute when the user is in a posture that precludes the 
completion of a step with a heel strike.  In unimpaired walking this is a very rare occurrence and 
typically  only  happens  when  a  very  small  step  is  taken,  however,  for  new  users  in  the 
exoskeleton who walk with significant torso lean, this state is often encountered. 
The complete active trajectory generation state machine as presented in this section 
along  with  the  geometric  constraints  were  used  to  calculate  the  remaining  leg  reference 
information are provided in Figure 5.14. 
 
Figure 5.14 – Summary of Leg Geometry Calculation Constraints 
5.3  ACTIVE TRAJECTORY GENERATION RESULTS 
In application this method works well to generate the joint trajectories online.  As Figure 
5.15 shows, the trajectories generated for normal upright walking is very similar to that of the 
simple method.  There are added benefits in this application though, as the peak hip flexion 
angle  was  reduced  by  6  degrees  because  the  active  method  does  not  need  to  be  as 
conservative as the trajectories from the simple method.  The real benefits of this technique 
come when applied to non-standard steps as shown in Figure 5.16 applied to a first step.  In this 
application the motion was more representative of the desired motion and the peak knee 
flexion was cut by 13 degrees and the peak hip flexion was cut by 6 degrees. 
44 
 
----------------80  
70
60
50
°]
e [ 40
gl
n 30
A
nt 
oi 20
J
10
Active Hip Joint
0
Actie Knee Joint
Simple Hip Joint
-10
Simple Knee Joint
-20 
0 0.2 0.4 0.6 0.8 1 1.2
Step Time [s]  
Figure 5.15 – Active and Simple Trajectory Generation Comparison for Upright Walking 
80  
70
60
50
°]
e [
gl 40
n
A
nt  30
oi
J
20
10 Active Hip Joint
Actie Knee Joint
0 Simple Hip Joint
Simple Knee Joint
-10 
0 0.2 0.4 0.6 0.8 1 1.2
Step Time [s]  
Figure 5.16 – Active and Simple Trajectory Generation Comparison for First Step 
45 
 
----------------6  TRAJECTORY GENERATION THEORETICAL EXTENSIONS 
Up to this point, the trajectory generation methods discussed have shown a wide range 
of application to the walking gait.  Despite the current success, there are some significant limits 
to their capabilities.  The current control cycle as shown in Figure 6.1, only has limited feedback 
into the trajectory  generation  process  and even  then  it  is  only  when  applying  the  active 
method.    In  the  active  method,  only  kinematics  are  used  for  feedback  to  adjust  for  the 
geometric constraints of the system where the user is expected to account for the dynamic 
disturbances.    In  the  simple  method  of  trajectory  generation,  there  is  no  state  feedback 
feedback used at all as the trajectories themselves are just a feedforward input to the low level 
controller.  Also, there is at no time any feedback on the user selected step parameters to verify 
that the device is meeting its expected step performance. 
 
Figure 6.1 – Implemented Control Architecture 
T  is the desired step time parameter and L  is the desired step length parameter 
D D
To  correct  these  issues,  two  modifications  are  proposed  to  the  current  control 
architecture.  The first is to develop a method to incorporate dynamic feedback into the 
trajectory generation process.  With this added feedback, the trajectory generator can actively 
work to alleviate the burden on the user for overall balance and stability while creating a more 
natural  gait.    The  second  primary  modification  is  the  addition  of  feedback  on  the  state 
parameters provided by the user to ensure that the step is being executed as desired.  The 
modified control architecture that includes this step parameter feedback can be seen in Figure 
6.2.  It is important to note that these are referred to as theoretical extensions because they 
currently require more capability than is provided by the current device and in turn cannot be 
implemented on the real system as is. 
 
Figure 6.2 – Modified Control Architecture for Theoretical Trajectory Generation Extensions 
V  is the desired step time parameter, T  is the step time parameter and L  is the step length parameter 
D D D
 
 
46 
 
----------------6.1  NEAR OPTIMAL TRAJECTORY GENERATION 
In unimpaired bipedal walking the brain is able to generate effective and efficient joint 
angle trajectories throughout the walking cycle.  These trajectories are customized for the 
needs of the user and work with the users individual dynamics in mind.  This extension intends 
to present a framework for determining the near optimal gait trajectories for an exoskeleton 
gait based on initial conditions and a desired walking maneuver similar to those trajectories 
that would be generated by an unimpaired subject given the same input conditions.  The 
method presented will use an optimization format to determine the near optimal trajectories. 
6.1.1  PROBLEM FORMULATION 
Optimization Formulation 
This strategy structures the problem as a nonlinear optimization problem.  Below is the 
optimization formulation that was initially evaluated for this problem as shown in Equation 6.1 
with a final cost represented by  and an individual state cost represented by   
where both are discussed in detail later in this section. 
&:(cid:2)(cid:3),;(cid:4)  &(cid:2)(cid:3),;(cid:4)
 
 
(cid:26)
min ?&:(cid:2)(cid:3),;(cid:4)+@ &(cid:2)(cid:3),;(cid:4)ABC
2>(cid:18)>(cid:26)
2 Equation 6.1 
  subject to 
 
(cid:1)(cid:2)(cid:3)(cid:4)(cid:3)(cid:5) +(cid:7)(cid:2)(cid:3)(cid:10),(cid:3)(cid:4)+(cid:12)(cid:2)(cid:3)(cid:4) = ;  
  where  (cid:27)(cid:17)(cid:18)sin(cid:3)(cid:17)(cid:18) −(cid:27)(cid:26)Dsin(cid:3)(cid:26)D −(cid:27)(cid:17)Dsin(cid:3)(cid:17)D −EFFBGHI ≥ 0
 
(cid:27)(cid:17)(cid:18)sin(cid:3)(cid:17)(cid:18)(cid:2)(cid:16)(cid:4)−(cid:27)(cid:26)Dsin(cid:3)(cid:26)D(cid:2)(cid:16)(cid:4)−(cid:27)(cid:17)Dsin(cid:3)(cid:17)D(cid:2)(cid:16)(cid:4)−EFFBGHI = 0  
(cid:27)(cid:17)(cid:18)cos(cid:3)(cid:17)(cid:18)(cid:2)(cid:16)(cid:4)+(cid:27)(cid:26)Dcos(cid:3)(cid:26)D(cid:2)(cid:16)(cid:4)+(cid:27)(cid:17)Dcos(cid:3)(cid:17)D (cid:2)(cid:16)(cid:4)+EFFBGHI = KBLM(cid:27)NHO
(cid:3)(cid:26)D(cid:2)(cid:16)(cid:4) = (cid:3)(cid:17)D(cid:2) (cid:16)(cid:4)
(cid:3)(cid:2)0(cid:4) = (cid:3)2  
(cid:3)3/P ≤ (cid:3) ≤ (cid:3)34. 
;3/P ≤ ; ≤ ;34.
The path constraints included maintain that the toe and heel of the swing foot stay 
above ground throughout the gait and that the foot finishes the gait on the ground and at the 
desired step length.  The specific angles and geometry of the model used are discussed in 
greater  detail  in  the  system  model  portion  of  this  section.    Another  aspect  of  the  path 
constraints is that they incorporate the foot geometry in the variable  .  Because the 
EFFBGHI
47 
 
----------------model does not incorporate an ankle joint, the toe and heel maintain a fixed relationship to the 
shank throughout the motion and can be added into the optimization to accurately account for 
the toe and heel coordinates.  The specific geometry used in this aspect of the model is 
application specific and must be determined based on the geometry of the system it is being 
applied to.  Through experimentation it was found that the most robust structure for this 
problem was to relax the optimization constraints and move the final step length constraint to 
a final step cost.  This leads the optimization routine to find acceptable trajectory results much 
more reliably.  Figure 6.3 shows the difference in resulting trajectories from the relaxed and 
rigid optimization structures. 
 
(A)          (B) 
Figure 6.3 – Optimized Gait Solutions for Different Optimization Formulations 
(A) Shows step optimization result for rigid optimization formulation, (B) Shows improved step result for 
relaxed optimization result with the same initial conditions. 
The final relaxed optimization formulation is as follows:  
 
 
(cid:26)
min ?&:(cid:2)(cid:3),;(cid:4)+@ &(cid:2)(cid:3),;(cid:4)ABC
2>(cid:18)>(cid:26)
2 Equation 6.2 
  subject to 
 
(cid:1)(cid:2)(cid:3)(cid:4)(cid:3)(cid:5) +(cid:7)(cid:2)(cid:3)(cid:10),(cid:3)(cid:4)+(cid:12)(cid:2)(cid:3)(cid:4) = ;  
  where  (cid:27)(cid:17)(cid:18)sin(cid:3)(cid:17)(cid:18) −(cid:27)(cid:26)Dsin(cid:3)(cid:26)D −(cid:27)(cid:17)Dsin(cid:3)(cid:17)D −EFFBGHI ≥ 0
 
(cid:27)(cid:17)(cid:18)sin(cid:3)(cid:17)(cid:18)(cid:2)(cid:16)(cid:4)−(cid:27)(cid:26)Dsin(cid:3)(cid:26)D(cid:2)(cid:16)(cid:4)−(cid:27)(cid:17)Dsin (cid:3)(cid:17)D(cid:2)(cid:16)(cid:4)−EFFBGHI = 0
(cid:3)(cid:26)D(cid:2)(cid:16)(cid:4) = (cid:3)(cid:17)D(cid:2)(cid:16)(cid:4)
48 
 
---------------- 
(cid:3)(cid:2)0(cid:4) = (cid:3)2  
(cid:3)3/P ≤ (cid:3) ≤ (cid:3)34. 
;3/P ≤ ; ≤ ;34.
The final relaxed optimization formulation, as shown in Equation 6.2, was implemented 
in Matlab with the use of PROPT from Tomlab.  In general this optimization platform was able 
to accomplish the desired optimization procedure quickly and effectively but there were some 
minor issues with its limitations that directed this analysis that will be discussed as they are 
encountered throughout the section. 
System Model 
The system model being used for the following analysis is a variation of the 5 degree of 
freedom model presented in Section 3 of this dissertation.  It is a sagittal plane point mass 
model of a kneed bipedal human walker with a torso and a swing foot.  The system model was 
further simplified to include only four segments, where the knee of the stance leg was omitted 
and assumed to be locked.  This is an acceptable simplification because in application the knee 
of the stance leg is close to straight for a significant portion of the single stance phase as shown 
in Section 4.  The model diagram can be seen in Figure 6.4. 
 
Figure 6.4 – 4 Link Walking Model Diagram as Used in Trajectory Optimization 
The foot is considered to be a zero mass object and is always perpendicular to the swing 
shank.  Removing the dynamics of the swing foot is not a significant source of error because the 
primary effect that the swing foot has on the system is as an obstacle for toe clearance which is 
preserved.  The system has three inputs in the form of the torques provided at the stance hip, 
the swing hip and the swing knee. 
The system dynamics used for this analysis are simplified to make them easier to input 
into the optimization format.  The first step to developing the simplified system dynamics used 
49 
 
----------------in the analysis is to compute the full system dynamics for the point mass system described 
above using Legranian dynamics.  The resulting dynamic equations that define the system are 
of the form shown in Equation 6.3.  A complete evaluation of these dynamics can be found in 
the appendix located in Section 12 of this dissertation. 
 
 
(cid:1)(cid:2)(cid:3)(cid:4)(cid:3)(cid:5) +(cid:7)(cid:2)(cid:3)(cid:10),(cid:3)(cid:4)+(cid:12)(cid:2)(cid:3)(cid:4) = ; Equation 6.3 
To input these dynamic equations into the optimization structure they needed to be 
explicitly solved for the angular acceleration values.  In this system of four equations that is a 
much simpler said than done.  When solved using the symbolic toolbox in Matlab, the solved 
equations for the four accelerations were nearly 3 pages long which led to it being completely 
infeasible to input into the optimization format.  The structural simplification made to the 
dynamics that makes these dynamic equations useful is the creation of synthetic system inputs.  
In this case the synthetic inputs used are the angular accelerations of the relative joint angles.  
This is beneficial because it results in a much simpler dynamic format as shown in Equation 6.4. 
 
 
(cid:3)(cid:5) = *(cid:2)(cid:3)(cid:4)R+,(cid:2)(cid:3)(cid:10),(cid:3)(cid:4)+S(cid:2)(cid:3)(cid:4) Equation 6.4 
where 
(cid:3)(cid:17)(cid:5) (cid:18)  
R = (cid:21)(cid:3)(cid:5)(cid:26)D#
(cid:3)(cid:5)(cid:17)D
Then based on the initial system dynamics the original input signals can be calculated as 
a function of the synthetic inputs used to simplify the system.  This allows the optimization to 
still be aware of constraints on initial input and used to determine power input at the joints 
throughout the cycle. 
It is important to note that all the initial conditions of the system will correspond to 
after the toe of the walker has left the ground.  The primary reason for this consideration is 
because human walking is a very hybrid system, in which it exhibits many different sets of 
continuous dynamics with discrete transitions between the states.  The dynamics of the system 
are significantly different based on whether the foot of the swing leg is on the ground or not so 
this problem is addressed by placing the system into one of the discrete modes operation.  
Prior to application this modification will need to be accounted for by placing this technique 
within a state machine that provides a pre-swing state to prepare the optimization state by 
picking the foot off the ground, however, this will not be addressed within the scope of this 
extension. 
50 
 
----------------Cost Function 
The cost function is the item that makes this method work so strongly.  It allows the 
desired result to be shaped based on what is more important very succinctly and effectively.  To 
develop the cost function the most important criteria that distinguish one step over another 
must be identified.  To meet the set forth criteria of matching the efficiency and effectiveness 
of the gait of an unimpaired human, two criteria were identified.  First, the torso stability 
exhibited by the gait, in the form of penalizing for angular velocity of the torso and second, was 
the power used at the joints in a step.  The resulting cost function that was used in this 
optimization and has shown the most reliable results is shown in Equation 6.5. 
 
 
&(cid:2)T,;(cid:4) = UV(cid:2)T,;(cid:4) Equation 6.5 
where 
(cid:25)  
(cid:25)
(cid:2) WXFYZB 8F[L(cid:24)(cid:4) _;(cid:17)(cid:18)(cid:8)(cid:3)(cid:10)(cid:26)I −(cid:3)(cid:17)(cid:10) (cid:18)(cid:11)+;(cid:26)D(cid:8)(cid:3)(cid:10)(cid:26)I −(cid:3)(cid:10)(cid:26)D(cid:11)+;(cid:17)D(cid:8)(cid:3)(cid:10)(cid:26)D −(cid:3)(cid:17)(cid:10) D(cid:11)`
V = (cid:14) (cid:20) = (cid:14) (cid:20)
(cid:25) (cid:25)
(cid:2)(cid:16)F(cid:24)(cid:28)F *Z&\L ]L\FUYB^(cid:4)   (cid:3)(cid:10)(cid:26)I
U = [0.001 1]
For the cost function when implemented on an exoskeleton there is another feature 
that could be added to improve the effectiveness of this optimization but it was left out 
because it is not a factor in unaffected gait.  The desired feature was the addition of a clearance 
height cost.  This would have been used to penalize the gait for clearing too close to the 
ground.  This method can be implemented by adding an exponential component to the cost 
function based on the clearance height.  This is important primarily because the optimization 
routine requires a differentiable cost function.  This feature was not needed in this calculation 
because the to replicate the gait of an unaffected subject the toe is only required to clear the 
ground  
The final cost is used to enforce the relaxed optimization constraints of reaching the 
desired step length and the desired torso angle as shown in Equation 6.6. 
 
 
&:(cid:2)T,;(cid:4) = U:V:(cid:2)T,;(cid:4) Equation 6.6 
where 
 
(cid:25)
(cid:2) KBLM (cid:27)LZ&Bℎ f(cid:24)(cid:24)F(cid:24)(cid:4)
V: = d (cid:25)g
(cid:2)(cid:16)F(cid:24)(cid:28)F *Z&\L f (cid:24)(cid:24)F(cid:24)(cid:4)
U: = [100 1]
51 
 
----------------6.1.2  OPTIMIZATION RESULTS 
Normal Walking 
More existing information exists for the steady walking portion of the human gait than 
any other portion of human walking.  But this information is not clear as to how it must be 
modified to match each particular set of initial conditions.  Here the optimization routine is 
applied to a set of initial conditions that corresponds to a walking pose found in a steady 
walking raw data set produced by Winter [47].  A random amount of noise is added to that 
initial condition to result in a wide variety of optimization solutions.  
The masses and lengths used in this analysis were selected to approximate adolescent 
male used to generate the raw data provided in Winter.  The individual lengths and masses 
were determined based on the anthropomorphic data provided in Winter [47]. 
The analysis can be easily seen to result in acceptable walking trajectories as shown by 
Figure 6.5, Figure 6.6 and Figure 6.7.  The trajectories can be seen to correlate strongly to the 
unimpaired trajectories available in literature [47, 48, 49].  This shows that the cost functions 
selected are sufficient to characterize the decisions made subconsciously in unimpaired bipedal 
walking.   
 
Figure 6.5 – Near Optimal Swing Phase Body Posture for Normal Walking 
 
52 
 
----------------40  
Winter CGA
30 Kirtley CGA
Linskell CGA
Calculated
20
]
g
e 10
d
 [
e
gl 0
n
A
-10
-20
Stance Swing
-30 
0 20 40 60 80 100
Cycle Percentage [%]
 
Figure 6.6 – Near Optimal Hip Angle Trajectories for Normal Walking 
80  
Winter CGA
70
Kirtley CGA
Linskell CGA
60
Calculated
50
]
g
e
40
d
 [
e
gl 30
n
A
20
10
0
Stance Swing
-10 
0 20 40 60 80 100
Cycle Percentage [%]
 
Figure 6.7 – Near Optimal Knee Angle Trajectories for Normal Walking 
The optimizer was also able to develop optimal trajectories unique to each of the 
different initial conditions as shown in Figure 6.8 and Figure 6.9.  These trajectories would have 
been impossible to plan before hand using existing trajectory generation methods and would 
only be used given the ability to plan the entire step as is done with this method.  The level to 
which the optimized trajectories match up with the accepted CGA trajectories shows that the 
trajectory planner was able to generate trajectories similar to those that would be generated by 
a healthy individual. 
53 
 
----------------80  
Winter CGA
70 Kirtley CGA
Linskell CGA
60 Calced 1
Calced 2
50 Calced 3
Calced 4
g] 40 Calced 5
e
d
e [
gl 30
n
A
20
10
0
Stance Swing
-10 
0 10 20 30 40 50 60 70 80 90 100
Cycle Percentage [%]
 
Figure 6.8 – Near Optimal Knee Angle Trajectories at Various Initial Conditions 
 
40  
30
20
g] 10
e
d
e [ Winter CGA
gl
An 0 Kirtley CGA
Linskell CGA
Calced 1
-10
Calced 2
Calced 3
-20 Calced 4
Calced 5
Stance Swing
-30 
0 10 20 30 40 50 60 70 80 90 100
Cycle Percentage [%]
 
Figure 6.9 – Near Optimal Hip Angle Trajectories at Various Initial Conditions 
 
54 
 
----------------First Step 
While the ability of this method to match the known data of steady state walking is very 
useful, the primary benefit is its ability to generate data for unknown regions of the walking 
gait.  The first step is one primary region where using the simple trajectory generation method 
leads to very poor overall performance of the gait.  This method is capable of determining a gait 
trajectory similar to the trajectories that would be generated by an unimpaired human in the 
same scenario. 
The simulations in this section are completed on a walker with the lengths and masses 
of the adolescent male as presented by Winter and used in the earlier section.  The initial 
conditions of this section correspond to the first step just after the swing toe has left the 
ground but there is no angular velocity.  This is important about the initial conditions for the 
first step because no velocity corresponds to the walker having no forward momentum which is 
by far the worst case scenario for the first step of walking.  Despite these initial conditions the 
trajectory generator is still capable of generating a very acceptable gait trajectory for the first 
step  as  shown  in  Figure  6.10.    The  relative  joint  trajectories  produced  by  the  trajectory 
generator are found in Figure 6.11.   
One interesting aspect of the first step trajectories is that they let the walker fall 
forward to gain some momentum and then extends the leg to catch itself. This phenomenon is 
very similar to that observed in the first step of healthy human walking but due to the lack of 
extensive cases to evaluate, reliable trajectories have yet to be identified. 
This method allows the differences in the effect of particular initial conditions to be 
clearly identified and leads to being able to identify trajectories to account for the many initial 
condition variations much easier. 
 
55 
 
---------------- 
Figure 6.10 – Near Optimal Swing Phase Body Posture for a First Step 
56 
 
----------------60  
Stance Hip
50 Swing Hip
Swing Knee
40
30
g]
e
d
e [ 20
gl
n
A
10
0
-10
-20 
0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8
Step Time [s]  
Figure 6.11 – Near Optimal Joint Angle Trajectories for a First Step 
Currently, this method has not been applied to the actual system for one primary 
reason.  The optimization routine is extremely calculation intensive and requires far more 
computing power than is available in the face of a real time system.  On a desktop computer 
running with a processor speed of 2GHz, the optimization takes nearly 10s to complete the 
calculation.  In a real time bipedal application, the swing phase can take between 0.6 and 1 
second.  So in order to be a realistic option for trajectory generation, the calculation would 
need to complete in 0.1 seconds at the longest on the embedded 100 MHz processor that is 
included on the device. 
Despite  not  being  implementable,  this  technique  provide  a  significant  result  by 
demonstrating  the  applicability  of  this  simple  cost  function  to  accurately  represent  the 
decisions made in unimpaired walking.  With future improvements in processing power, or the 
application of other techniques such as Value Iteration, there may be possibilities for this to be 
implemented at a later time. 
6.2  STEP PARAMETER PLANNING 
Another  limitation  to  the  current  implementation,  is  that  the  step  parameters  are 
currently selected by the user and then fed into the trajectory generation method without 
verifying that they are executing correctly. Regardless of how the trajectories are generated, 
enough uncertainty exists in the system due to the model or the input from the user that there 
are few guarantees that the steps will be conducted as desired by the user.  The technique 
57 
 
----------------presented here, provides a method for feedback control of the step parameters in order to 
control that the desired motion is executing. 
Dynamic Analysis 
The intended result of the step parameters is that the executed step meets the user 
selected values.  Unfortunately, the dynamics of the gait make it impossible for all the step 
parameter combinations to be executed given the presented methods for generating step 
trajectories.  The results of trajectories for steps at (12in, 2s), (24in, 4s) and (6in, 1s) will all lead 
to different stable walking gates despite the fact that the desired velocity is the same for all 
three gaits.  This is because behind the step length and step time that the user selects is a 
desired velocity that has only one step parameter setting that results in that desired velocity.  
By changing the user input parameter to a desired walking velocity, a step time and step length 
can be determined that leads to a stable gait at the desired velocity for all selectable walking 
velocities. 
A stable gait is defined by balanced energy throughout the gait cycle in that the energy 
input to the system is equal to that lost through the gait cycle as shown in Equation 6.7.  At this 
point, all the work has been to establish the process by which energy is put into the system.  
The primary contributors to the input energy is the torque input from the actuators and in turn 
the trajectory generation method used, as well as how the specific user interacts with the 
device.   None of these inputs should be adjusted for the purpose of step parameter planning 
because the device has no sensing of users interaction with the machine.  It is also not clear 
how the trajectory generation methods presented earlier would be modified to adjust the 
energy input to the system. 
 
@ fZL(cid:24)&^(cid:23)IO(cid:18) = @ fZL(cid:24)&^iPhj(cid:18)
(cid:17)(cid:18)Hh (cid:17)(cid:18)Hh Equation 6.7 
The missing piece is that nothing discussed in previous sections provides insight into 
what inputs control the energy lost through the gait cycle.  Literature suggests that the primary 
source of energy loss through the gait cycle is due to the impact at heelstrike [63].  The energy 
lost at heelstrike is due to the coefficient of restitution of the vertical component of the center 
of mass velocity as shown in Figure 6.12.  Based on the fact that a percentage of the vertical 
velocity is lost at impact, by adjusting the ratio of forward velocity to vertical velocity can 
provide a direct control input to the amount of energy that is lost at heelstrike.  Some simple 
dynamic analysis using a rigid body collision assumption of the leg geometry and dynamics as 
shown in Equation 6.8, suggests that the length of the commanded step is directly proportional 
to the energy lost.  In turn, following a step the device can determine if more or less energy 
needs to be burnt off from the following step and act accordingly. 
58 
 
---------------- 
Figure 6.12 – Step Parameter Planning Point Mass Model 
Shows center of mass velocity vectors both before and after heel strike impact 
 
 
m
fZL(cid:24)&^(cid:23)IO(cid:18) ∝ ]l −]l = ]l(cid:2)1−L(cid:4) = ]sin(cid:3) ∝ (cid:27)(cid:17)(cid:18)Hh Equation 6.8 
Control Design 
The controller designed for this application is a discrete control layer that exists in an 
outer loop compared to the trajectory generation and low level control segments of the control 
as shown in Figure 6.2.  This controller must be discrete because the input necessary to 
compute a future control action is the resulting velocity of the step and thus new actions can 
only be determined after each individual step.  The control method will use the feedback from 
the actual resulting velocity of the walking gait to close the loop on the user selected desired 
velocity and generate outputs of desired step time and step length. 
The controller starts with a user selected desired velocity and an initialized desired step 
length of typically 12 inches.  The controller has three simple steps involved in its execution.  
First, the controller computes a desired step time parameter that matches the current desired 
step length and velocity.  Second, the desired step time and length are fed into the trajectory 
generator  and a  step  is  executed.    Third,  the  desired  step  length  is  adjusted  using  a  PD 
controller based on the error between the desired execution time and the actual execution 
time as shown in Equation 6.9.  This update can be made because as the actual execution time 
is  too  fast  compared  to  the  desired,  the  controller  is  acting  on  the  simple  control  law 
established above and increases the step length in order to burn more energy at heelstrike.  
The control diagram can be seen in Figure 6.13. 
 
(cid:27)NHO/nHo ← (cid:27)NHO/nHo +L(cid:26)(cid:2)qr +qN(cid:28)(cid:4) Equation 6.9 
  where 
 
L(cid:26) = (cid:16)NHO/nHo −(cid:16)st(cid:18)j4u
59 
 
---------------- 
Figure 6.13 – Step Parameter Planning Block Diagram 
V  is the desired forward velocity, T  is the step time parameter, L  is the step length parameter,    
Des Des Des
T  is the actual step time and e  is the error in the step time 
Act T
Simulation Results 
The simulations used to verify the functionality of this controller were done using the 
three  link  simplified dynamic  model  presented  in  Section  3.   Body  segment  masses  were 
distributed proportional to accepted biomechanic proportions [47] between the torso and each 
leg, but the lengths of the segments to an arbitrary length of 1 meter.  The lengths have no 
significant  effect  on  the  functionality  of  the  controller  and  thus  this  simplification  was 
acceptable. The trajectory generation method used in the simulations established sinusoidal hip 
angles from the starting angle to the intended ending hip angle needed to reach the desired 
step length with a period of one gait cycle.  The desired joint angle trajectories were tracked 
with a PD low level controller similar to that of the actual device.  While both the method of 
trajectory generation and the type of low level controller implemented will have an effect on 
the resulting stable step length and step time, the controller has no knowledge of them and 
handles these differences as disturbances to the system. 
The controller was capable of tracking a desired set point velocity from an arbitrary set 
of initial conditions.  As shown in Figure 6.14, when planning step parameters to track a desired 
walking velocity of 0.38 m/s the actual velocity exhibited some overshoot and then steadied out 
on the desired velocity.  The bipedal walker required seven steps to fall within 10% of the 
desired velocity and 11 steps to track within 2%. 
60 
 
----------------0.48  
Desired Velocity
0.46 Actual Velocity
0.44
0.42
s]
m/ 0.4
y [
t
ci
o 0.38
el
V
0.36
0.34
0.32
0.3 
0 5 10 15
Time [s]
 
Figure 6.14 – Step Parameter Planning Velocity Tracking 
The response of the controller was also evaluated in the presence of a change in the 
desired velocity.  In this scenario, as shown in Figure 6.15, the controller is able to track 
between two different desired velocities within 20 steps.  An interesting aspect of the tracking 
of the desired velocity, is that as the reference changes, the closed loop dynamics exhibit a non-
minimum phase characteristics as the initial response to the change in the desired velocity is 
opposite the direction of the error.  Again, some overshoot is seen but the actual velocity does 
settle on the desired velocity. 
0.54  
Desired Velocity
0.52 Actual Velocity
0.5
0.48
s]
m/
0.46
y [
t
ci
o 0.44
el
V
0.42
0.4
0.38
0.36 
0 5 10 15 20
Time [s]
 
Figure 6.15 – Step Parameter Planning Varying Reference Velocity Tracking 
61 
 
----------------While this control strategy does provide a way to easily develop a steady walking gait 
without a system model, some drawbacks were seen in this initial implementation that must be 
evaluated prior to implementation.  The first is that the method can only handle an initial 
velocity delta of between 0.12 and 0.15 m/s and still maintain a stable step.  If too large of an 
initial velocity delta is present, then the controller has the potential to over correct to the point 
where  the  walker  cannot  complete  the  requested  step  and  either  falls  forward  over  the 
heelstike foot or does not have enough momentum to get over the stance leg.  This could be 
alleviated by improving the controller from a simple model free linear PD controller, to one that 
uses the dynamics of the system to either feedforward into the PD controller or by designing a 
model based controller. 
The second drawback of this method is that while it does find step parameters that lead 
to a stable gait, the generated gait may require a lot of power.  This can be seen as the 
controllers attempts to reach a high velocity, the step length will continue to update to shorter 
faster steps to reduce the amount of energy lost at heelstrike.  This happens because the only 
input this controller has access to is the step length.  In unimpaired walking, the energy input to 
the system can be modified as well by changing the trajectory generation method.  This way the 
unimpaired gait can find a low power method for reaching the desired velocity.  One method 
for addressing this issue is to limit the range of velocities that are allowed for the user based on 
the power required to complete the gait.  In turn, extremely fast desired velocities that would 
lead to excessive power input would never be allowed.  A second potential solution would be 
for the controller to modify the desired velocity to find the minimum cost of transport, which is 
energy per unit distance, for the given trajectory input. 
 
62 
 
----------------7  SUBJECT TESTING 
While  significant  effort  has  gone  into  the  theoretical  background  of  the  controller 
applied  on  the  exoskeleton,  the  lack  of  a  sufficient  system  model  requires  significant 
verification through subject testing.  This is an aspect of control that is necessary due to the 
human centered nature of the exoskeleton application and is needed to identify the realistic 
effectiveness of the device.  In addition to this, some of the specific aims of this project are 
focused  on  the  user  response  to  the  system  and  must  be  verified  based  on  actual  user 
experience. 
One such goal that must be verified is that the device controller is intuitive to the user 
thus allowing new users to quickly pick up use of the device.  This is necessary for use of this 
type of device because the subjects must be able to use the device at an adequate level to 
begin perfecting the use of the device.  Second, once using the device, the user must be able to 
improve their level of expertise.  The users showing significant improvement in the use of the 
device is needed to maintain the potential of future applications in the home mobility market.  
The final aspect that requires significant verification is that the device requires less energy 
expenditure from the user than current mobility options.  This functionality is essential for both 
rehabilitation and mobility applications because all current mobility options are limited due to 
their energy expenditure requirements. 
All subject testing has been conducted under the guidance of human subject testing 
protocols.  In addition to this, the testing has been conducted in as safe an environment as 
possible based on the desired results of the testing by either maintain use of an overhead 
safety tether or by using a dedicated trained spotter.  The trajectory generation for all the 
presented subject testing was done with the simple trajectory generation method and using the 
therapist controlled HMI method presented in Section 4. 
7.1  MULTI-SUBJECT PILOT STUDY 
The first subject testing verification objective is to determine if the controller is intuitive 
to the user.  There is a minimum level of operator skill that is necessary to use the device at a 
functional  level  that  includes  standing  and  walking.    While  the  controller  is  designed  to 
minimize what is required of the user, if only a limited portion of the patient population is 
capable of reaching that level then the controller would be deemed too difficult.  In this case, 
for  the  device  to  have  the  potential  of  widespread  application  across  the  mobility  and 
rehabilitation markets, it must have a controller that accommodates a large range of users. 
Test Description 
The test for this verification objective involved a pilot study at the Motion Analysis and 
Motor Performance Laboratory at the University of Virginia’s Kluge Children’s Rehabilitation 
Center using the mobile exoskeleton.  The study involved seven spinal cord injury patients of 
various injury levels as detailed later in this section.  Each patient received a single two hour 
63 
 
----------------testing  session,  where  the  subject  was  first  introduced  to  the  device  and  fitted  into  the 
machine.  Upon arrival anthropometric measures were taken and the subject was fitted with 
the eLEGS device.  Hip, knee and ankle joints of the exoskeleton were aligned with those of the 
subject.  All tests were performed under a safety tether to prevent the subject from falling, and 
a spotter was close by to assist if necessary. 
Once fitted, the exoskeleton raised the subjects into a standing position using a walker 
for balance.  The subjects walked using a walker until they demonstrated a level of skill that 
allowed for transitioning to crutches as determined by the operator.  The walking was done in 
20’ strait segments, in which subjects typically required 40’ of walking before transitioning to 
lofstrand crutches.  Upon transitioning to the lofstrand crutches, the subjects were further 
assisted until they were able to walk unassisted.  The device was operated in the simple HMI 
mode, in which the therapist has control of triggering each individual step through the GUI.  As 
discussed  in  Section  4,  eLEGS  has  a  user  operated  mode,  however, for  early  training  the 
therapist controlled mode provides the most safe environment for the subject to learn to 
operate  the  device.  While  in  therapist  controlled  mode,  the  steps  were  triggered  by  the 
therapist when the subject had transferred their weight over the stance leg. 
Then the user was sat down and given a 15 min break at which time a full body set of 
reflective markers (38) was applied to the subject and exoskeleton with additional markers 
placed on the lofstrand crutches as shown in Figure 7.1.  Following the break, the user was 
stood again and the motion analysis system was calibrated before walking was resumed. 
 
 
Figure 7.1 – Multi-subject Pilot Study Motion Capture Marker Locations 
64 
 
----------------Three-dimensional kinematic data was collected using with a Vicon 8 camera motion 
analysis system at 120Hz.  Additionally, ground reaction forces were measured using integrated 
6 degree-of-freedom force plates in the center of the walking path.  Data from the machine 
including joint angles, foot sensors, torso angle, and motor currents were also recorded on the 
exoskeleton computer.  The entire time walking in the device at the end of the testing session 
did not exceed 45 min.  At the end of testing the user was inspected for signs of excessive 
pressure concentrations. 
Patient Descriptions 
The pilot study used 7 subjects which included 3 incomplete and 4 complete injuries.  
The subjects were also selected in accordance with the human subject testing protocol to have 
a good mix of injury levels, body sizes and gender.  The breakdown of the individual subjects 
can be seen in Table 7.1.  The injury to subject 7 is different than that of the other subjects 
because he has Friedreich’s Ataxia which is an inherited disease characterized by progressive 
nervous system degradation.  This disease typically results in spinal degradation that can affect 
natural gait patterns which are in turn addressed with available gait rehabilitation methods 
[64]. 
Table 7.1 – Multi-subject Pilot Study Subject Summary 
Subject  Time Since  Weight 
Injury Type  Age [yr]  Height  Gender 
Number  Injury [yr]  [lbs] 
1  Spinal Cyst – C7 – AIS C  32  44  5’ 5”  125  F 
2  Paraplegic – T10 – AIS A  9  28  5’ 10”  140  M 
Paraplegic with minor brain 
3  5  25  5’ 7”  121  F 
injury – T8 – AIS A 
4  Paraplegic – T5 – AIS A  3  22  6’ 1”  165  M 
5  Tetrariplegic – C5 – AIS C  5  25  5’ 8”  120  M 
6  Paraplegic – T5 – AIS A  2.5  24  6’ 1”  155  M 
Friedreich’s Ataxia 
7  38  53  5’ 10”  145  M 
(Presents like Incomplete) 
Results 
In general the subjects took slow controlled steps during the testing.  For all but one of 
the subjects, the data was collected when the subject was walking unassisted on lofstrand 
crutches.  The only exception was subject 6 who was only able to walk unassisted using a 
walker during the single testing session.  After processing the Vicon 3D kinematic motion 
capture data, only subjects 2, 3 and 5 had sufficient data to estimate the overground walking 
velocity and mean step length.  The data for the other subjects was collected using the data 
logged from the computer processor.  The summary of all spatial temporal parameters can be 
found in Table 7.2. 
 
65 
 
----------------Table 7.2 – Multi-subject Pilot Study Spatial Temporal Parameters 
Mean Percent  Mean Percent 
Subject  Mean Step  Mean Step  Mean 
Single Support  Double Support 
Number  Time [s]  Length [in]  Velocity [ft/s] 
[%]  [%] 
1  4.43  22.64  0.43  30.21  69.79 
2  6.07  22.31  0.31  21.63  78.37 
3  5.48  18.70  0.28  25.77  74.23 
4  7.51  18.57  0.21  16.79  83.21 
5  3.95  24.70  0.52  36.77  63.23 
6  7.61  18.09  0.20  17.71  82.29 
7  3.62  26.51  0.61  33.39  66.61 
The gait of the patients with complete injuries was typically slower than that of the 
incomplete patients.  This slow down was primarily due to an elongation in the double stance 
portion of the gait cycle which increased by 20% for the subjects with complete injuries.  The 
longer double stance phases lead to 67% longer average step times for the complete injury 
patients. 
The sagittal plane joint angles for these subjects during walking demonstrate that the 
hip and knee controlled exoskeleton was able to generate a repeatable and reliable gait for the 
user.  The sagittal plane joint angles for the hip knee and ankle are provided in Figure 7.2 and 
are representative of the sagittal angles for the subjects.  The angles do not correspond to 
unimpaired gait trajectories because of the augmented angles generated by the trajectories 
and the extended double stance phases of the gait. 
One aspect of these angles that are specific interest are the ankle angles.  Unlike the hip 
and knee joints, the ankle is not actively controlled in the sagittal plane and instead is a passive 
joint that is managed by the user through the input of their arms.  At no time in the gait cycle 
does the joint reach the joint hardstops which means that the user was able to effectively 
maintain control of the overall body posture throughout the gait with just their upper extremity 
inputs through the lofstrand crutches.  While, future development will seek to lessen the 
requirement on the user’s arms, the typical user has shown the ability to assist with body 
posture without active exoskeleton intervention to balance the body in the sagittal plane. 
66 
 
----------------80  
Right Hip
Left Hip
60
Unaffected Hip
°]
e [ 40
gl
n
A
p  20
Hi
0
-20 
0 10 20 30 40 50 60 70 80 90 100
Percent of Gait [%]  
(A) 
100  
Right Knee
80 Left Knee
Unaffected Knee
°] 60
e [
gl
n 40
A
e 
e
n 20
K
0
-20 
0 10 20 30 40 50 60 70 80 90 100
Percent of Gait [%]  
(B) 
15  
10
5
°]
e [
gl 0
n
A
e  -5
kl
n
A -10
Right Ankle
Left Ankle
-15
Unaffected Ankle
-20 
0 10 20 30 40 50 60 70 80 90 100
Percent of Gait [%]  
(C) 
Figure 7.2 – Subject 2 Sagittal Plane Joint Kinematics 
(A) Hip joint kinematics, (B) Knee joint kinematics, (C) Ankle joint kinematics. Shaded area indicated 
single standard deviation about provided joint angle trajectories. 
67 
 
----------------For the subjects with incomplete injuries, other benefits were visible.  Subject 5 in 
particular can walk unassisted without use of the exoskeleton but has an impaired gait that 
presents itself in the form of limited knee flexion as shown in Figure 7.3.  However, with the use 
of the exoskeleton this patient experienced significantly increased knee flexion as well as a 
much more symmetric gait as shown in Figure 7.4. 
70  
Right Knee
60 Left Knee
Unaffected Knee
50
°]
e [ 40
gl
n
A
e  30
e
n
K
20
10
0 
0 10 20 30 40 50 60 70 80 90 100
Percent of Gait [%]  
Figure 7.3 – Subject 5 Sagittal Plane Knee Joint Kinematics without Exoskeleton 
Incomplete tetraplegic subject walking using no exoskeleton and no other walking aid.  Shaded area 
indicated single standard deviation about provided joint angle trajectories. 
 
80  
Right Knee
70
Left Knee
Unaffected Knee
60
50
°]
e [
gl 40
n
A
e  30
e
n
K
20
10
0
-10 
0 10 20 30 40 50 60 70 80 90 100
Percent of Gait [%]  
Figure 7.4 – Subject 5 Sagittal Plane Knee Joint Kinematics with Exoskeleton 
Incomplete tetraplegic subject walking using the exoskeleton.  Shaded area indicated single standard 
deviation about provided joint angle trajectories. 
68 
 
----------------Discussion 
The end result of this testing showed that 6 of 7 patients tested in the device were able 
to walk unassisted using lofstrand crutches in a single 2 hour training session.  The one subject 
who did not progress to unassisted walking was walking assisted using lofstrand crutches and 
unassisted in a walker at the end of the study.  This subject was the one subject who had 
difficulty controlling their body in the wheelchair.  During the testing he had issues with simple 
tasks such as transferring into and out of his wheelchair and balancing in a seated position.  For 
this reason, he may be a subject that is not a first adopter user who may be screened from 
future testing using increased prescreening criteria.  Despite this, the ability of 6 of the 7 
subjects to advance to autonomous walking in a single 2 hour training session indicates that the 
desired functionality of the device behaving in an intuitive manner has been sufficiently met. 
7.2  PATIENT PROGRESSION 
The next verification step to proving out the design goals of the controller is to show 
that the users can continue to improve their skills with the device through continued use.  As 
the users spend time in the device they must be able to significantly improve their skill level if 
they are going to be able to master the potential that the device offers.  This is essential in 
rehabilitation applications, and potentially in mobility as well, by providing an incentive to the 
users  to  continue  to  use  the  device.    This  particular  issue  is  one  major  issue  with  other 
mechanical therapy devices such as standing frames.  Many of these devices are not used 
regularly by the users because while the device still provides the potential health benefits of 
standing, the novelty has worn off and the device no longer challenges and engages the user in 
trying to get any better. 
Test Description 
The  test  for  this  verification  goal  involved  the  compilation  of  independent  testing 
sessions at the Berkeley Bionics testing facility and at UVA and involved two different subjects 
at different points in the learning cycle of the device.  For the testing at Berkeley Bionics the 
user donned the device that had already been fit and sized for him based on measurements 
recorded from a previous testing session.  The user stood up in the device and walked a series 
of 20’ straight runs until the user felt familiar with the device.  At that point, machine data was 
recorded including joint angles, torso angle, device state and controller output.  A typical 
testing session lasted about two hours with around 45 min of actual walking.  The user then sat 
down and doffed the device.  At UVA, the testing sessions were conducted just as presented 
earlier in this section, but the subject was tested on two consecutive days. 
Two different comparisons are evaluated in this test.  The first test compares the gait of 
a single patient from two different phases in the learning cycle to identify improvements in 
selected gait parameters that are indicative of gait effectiveness.  Due to the nature of the 
device, the controller is consistently being tweaked and between this subjects first testing 
session and second testing session many incremental modifications had been made resulting in 
69 
 
----------------an imperfect comparison.  However, currently no subjects have logged as much training time as 
this subject, so no data exists that compares the improvement of a single patient with no 
changes in the controller over such a wide spread of the learning cycle.  The second comparison 
is used to isolate this variable, by testing the second subject on the same controller at two 
different sessions to identify any learning 
Patient Descriptions 
The first subject used in the testing is a 24 year old male, T10 AIS A paraplegic.  The 
subject is 5 years post injury at the time of the testing, is 5’ 11” tall and weighs 145 lbs.  At the 
time of the first testing the subject had approximately 5 hours in the exoskeleton at the time of 
the first testing and 50 hours at the time of the second testing.  The second subject used in this 
comparison is a subject 4 from the UVA pilot study presented earlier in this section. 
Results 
The comparison for subject 1 shows that he has improved significantly with the device 
over  his  training  time.    Over  his  training  this  subject  has  demonstrated  significant 
improvements in nearly all of the metrics being used to measure ability as shown in Table 7.3.  
The subject showed a 48.9% improvement in step time, a 103.6% improvement in walking 
speed and a 25.3% reduction in duration double support.  The subject showed only a nominal 
improvement in step length of 3.8%. 
Table 7.3 – Subject 1 Spatial Temporal Parameter Comparison 
Mean Percent  Mean Percent 
Usage  Mean Step  Mean Step  Mean 
Single Support  Double Support 
Time [hr]  Time [s]  Length [in]  Velocity [ft/s] 
[%]  [%] 
5  7.20  24.19  0.28  39.97  60.03 
50  3.68  25.12  0.57  55.15  44.85 
The  comparison  for  subject  2  also  shows  significant  improvement  with  the  device 
between the first two testing sessions as shown in Table 7.4.  The subject demonstrated 
improvements in the same areas as the first subject but to a lesser degree.  He had a 34.0% 
improvement in step time, a 76.2% increase in walking speed and a 5.9% reduction in the 
duration of double stance support.  The subject showed only a nominal improvement in step 
length of 3.9%. 
Table 7.4 – Subject 2 Spatial Temporal Parameter Comparison 
Mean Percent  Mean Percent 
Testing  Mean Step  Mean Step  Mean 
Single Support  Double Support 
Session  Time [s]  Length [in]  Velocity [ft/s] 
[%]  [%] 
1  7.51  18.57  0.21  16.79  83.21 
2  4.96  19.29  0.32  21.70  78.30 
 
 
70 
 
----------------Discussion 
While  each  patient  is  expected  to  perform  differently  and  in  turn  have  their  own 
learning curve, these initial data points suggest that a significant amount of the subject learning 
can be done early in the testing based on these metrics.  This data suggests that after only a 
few testing sessions, subjects may be able to learn a large amount about the function of the 
device and then continue to improve as they use the device more.  Based on these subjects, the 
areas that have the most significant room to continue improving after the initial learning is the 
walking velocity and the duration of double support.   
These data points suggest that significant learning is possible for the user as they get 
more familiar with the device.  The comparison, however, is only suggestive because there is 
not direct comparison between the two subjects.  To fully quantify the expected nature of the 
learning curve for many subjects, a multi-subject test must be completed with evaluation of the 
same subjects at many different points throughout the learning process while using the same 
device software.  This was not conducted at this time, because not enough subjects have 
extensively  used  the  device  and  the  software  is  has  been  actively  changing  during  these 
subjects learning process. 
7.3  ENERGY EXPENDITURE 
The final verification test is to identify whether the exoskeleton leads to decreased 
energy expenditure by the subject.  This is a very important facet for a mobility device because 
while current walking alternatives exist for patients with spinal cord injuries, they are known to 
require  nearly  nine  times  more  energy  to  ambulate  in  than  an  unaffected  walking  [65].  
Showing this device successfully reduces the energy requirements for ambulation of a SCI 
subject will greatly improve its viability as an alternative tool for walking therapy. 
Test Description 
To test this, an experiment was conducted with a single subject at the Berkeley Bionics 
facility using a portable VO2 testing machine which measures the rate that oxygen is taken in by 
the body.  Oxygen consumption is a standard method for the verification of energy expenditure 
during ambulation [66, 67].  The device also records the amount of carbon dioxide exhaled by 
the body that is used to determine if the body is performing anaerobic work by looking to see if 
the  amount  of  exhaled  CO2  is  inconsistent  with  the  amount  of  oxygen  inhaled.    This  is 
important because in an anaerobic state, the oxygen consumed is less than the entire amount 
of energy consumed by the user because the body has begun processing stored energy reserves 
[68]. 
The experiment starts by running a baseline test that measures the energy required by 
the user while sitting in their wheel chair.  The test consists of remaining still and measuring the 
output of the VO2 device for a period of 5 to 7 minutes.  This time is to allow the body to reach 
a steady amount of oxygen consumption during the testing period.  The subject then donned 
the exoskeleton and took 10 to 20 steps to acclimate to the device.  At this point the user 
71 
 
----------------walked a 257 foot lap with the instruction to walk at a quick pace.  The distance of this lap was 
selected to provide enough time for the oxygen expenditure to stabilize as data from the VO2 
machine was recorded throughout the 6 to 7 minute lap.  The subject then rested for 15 
minutes during which they doffed the exoskeleton and donned their conventional walking aid.  
This subject uses two knee foot orthoses (KFOs) as conventional walking aids.   
The subject then walked the same 257 foot lap in the braces while the VO2 machine was 
recording.  The user was again asked to maintain a quick pace and told if their pace fell 
significantly below that of previous testing.  The subject then rested 15 minutes at which time 
they doffed the walking braces and donned the exoskeleton again.  Next, the subject walked 
the same 257 foot lap while in the device recording data and being instructed just as in the first 
exoskeleton test.  The user then rested for 15 minutes again at which time they doffed the 
exoskeleton.    To  finish  the  test,  the  user  once  again  took  a  baseline  test  sitting  in  their 
wheelchair. 
Patient Description 
The patient used in this testing is a 43 year old female, T10 AIS C paraplegic.  The subject 
is 18 years post injury at the time of the testing, is 5’ 7” tall and weighs 115 lbs.  The patient has 
trace hip adductors that have began firing following stem cell therapy.  The patient is a skilled 
exoskeleton user, having approximately 30 hours of testing at the time of the testing. 
Results 
The baseline tests at the beginning and end of the experiment were taken to verify that 
there was no significant trend in the data from the beginning of testing to the end.  As shown in 
Figure 7.5, the baseline results were very close to each other.  This can also be seen in the mean 
energy consumption after the signals stabilized as shown in Table 7.5. 
350  
Baseline Test 1
n] Baseline Test 2
mi
)/
2
O
ml  300
e [(
r
u
t
di
n
e
p
Ex 250
y 
g
r
e
n
E
200 
0 50 100 150 200 250 300 350 400 450
Test Time [s]  
Figure 7.5 – VO2 Rate Comparison for Baseline Tests 
Baseline tests taken sitting in wheelchair after oxygen consumption rate leveled off. 
72 
 
---------------- 
Table 7.5 – VO2 Average Rate Comparison for Baseline Tests 
Average O2 Rate 
 
[ml/min] 
Baseline Test 1  246.86 
Baseline Test 2  248.76 
The results from the walking tests also show significant distinction between the rate of 
oxygen consumption for the tests in the exoskeleton and the conventional walking aid.  As 
shown in Figure 7.6, the two exoskeleton tests were very similar to each other and the brace 
walking test showed a significant amount more oxygen consumption. 
1100  
1000
n]
mi 900
)/
2
O
  800
ml
e [( 700
r
u
t
di
n 600
e
p
x
E 500
y 
g
r
e 400
n
E Exo Test 1
300 Exo Test 2
Brace Test
200 
0 50 100 150 200 250 300 350 400 450
Test Time [s]
 
Figure 7.6 – VO2 Rate Comparison for Walking Tests 
Exo Test 1 and 2 correspond to laps in exoskeleton while Brace Test corresponds to testing in 
conventional KFO walking braces. 
The mean rate of consumption can be found in Table 7.6 after the values had stabilized.  
Also included are the mean velocities of each run.  The velocities were calculated by evaluating 
the time needed to travel 207 feet by the user where the first and last 25 feet were not 
included to omit the temporal effects of getting up to and slowing down from the steady 
walking speed.  Due to the fact that the velocities were substantially different between the 
three tests, the best comparison value is the cost of transport (COT) of the user which is the 
volume of oxygen consumed per unit distance traveled as opposed to time based on the 
average velocity of the individual test.  The final piece of information provided is the indexed 
consumption rates and COT.  These values are adjusted from their non-indexed versions by 
removing  the  average  baseline  consumption  to  compare  only  the  energy  consumption 
associated with the ambulation action.  All of these values can be seen in Table 7.6. 
 
73 
 
----------------Table 7.6 – VO2 Average Comparisons for Walking Tests 
Average  Average  Average O2  Average 
Average O2 
  Indexed O2  Velocity  COT  Indexed O2 
Rate [ml/min] 
Rate [ml/min]  [mph]  [ml/ft]  COT [ml/ft] 
Exo Test 1  618.44  370.63  0.475  14.79  8.86 
Exo Test 2  652.17  404.36  0.508  14.60  9.05 
Brace Test  967.10  719.29  0.385  28.58  21.25 
Discussion 
The data demonstrates a significant reduction in the energy expenditure for ambulation 
when using the exoskeleton when compared to conventional walking aids.  The use of the 
device resulted in a rate of oxygen consumption 53.9% of that consumed when using the 
walking braces when comparing the indexed rate values.  In addition to that, the average 
velocity when walking in the exoskeleton was noticeable increased which resulted in an even 
better  improvement  in  the  energetic  cost  of  transport.    Due  to  this  the  indexed  cost  of 
transport with the exoskeleton was only 42.1% of the conventional method.  This improvement 
is significant enough to suggest that the energy expenditure required for use of the exoskeleton 
would not be as significant a barrier to extended use that it is for brace walking. 
Another interesting aspect of this test is that some data suggested the results are 
conservative compared to the potential benefits.  The main aspect is that the ratio of oxygen 
consumed to carbon dioxide exhaled for the brace walking test was near the level that would 
indicate anaerobic work may have been done.  Over the walking time, the ratio averaged 0.995 
over the stabilized segment of the testing session.  A ratio of 1 indicates the anaerobic limit is 
reached, however, this limit is not a strict boundary so a tested ratio that is so close to 1 
indicates that for this patient the anaerobic limit may have been reached.  If it had been 
reached, the energy consumption estimated by the oxygen intake would be a conservative 
estimate of the energy used in the brace walking test.  If the actual energy consumed during 
this test were larger the percentage reduction would be even larger for the exoskeleton testing.   
While this test does indicate that there may be significant benefits in this area, it is not 
sufficient to guarantee that the benefits should be expected for the typical patient.  The 
primary issue with the test is that only one subject was evaluated.  In the future, similar tests 
on  a  larger  sample  size  of  subjects  can  be  conducted  in  order  to  accommodate  for  the 
fluctuations found in testing any one patient.  One such fluctuation that existed in this testing is 
that the subject’s braces, while custom fitted for her at the time of purchase, were identified by 
the physical therapist present during the testing as not being the best design for her condition.  
If it is the case that typical patients are in non-optimal braces then little change would be 
expected when the sample size expands, however, if this subject is the one person with poor 
braces then a large sample size would serve to drown out the perceived improvements shown 
by her testing. 
74 
 
----------------8  CONCLUSION 
This work sought to develop a control structure and a method of trajectory generation 
for eLEGS, a mobility exoskeleton for SCI patients, which is safe, practical and overcomes the 
limitations presented by existing options.  The controller was designed to take advantage of the 
users upper extremity input using lofstrand crutches and accommodate for the limitations 
presented by the physical system while meeting three specific goals.  First, the controller was 
structured such that it is applicable to a wide range of maneuvers, environments and control 
methods.    The  strategy  employed  must  allow  for  adding  to  the  available  maneuvers  to 
accommodate new needs without significantly limiting previous functionality.  Second, the 
trajectories generated for walking must be similar to that of an unaffected gait.  For many SCI 
subjects, there is potential to regain some degree of muscle control; therefore, the device must 
generate a healthy gait in order to provide a driven gait style of rehabilitation.  Third, the 
control output must be intuitive and repeatable.  This will allow users to quickly learn the 
function of the device and then continue to improve in their abilities as they adapt to the 
repeatable behavior of eLEGS. 
8.1  SUMMARY 
In the previous sections of this work, the difficulties found in developing a complete and 
accurate system model were discussed.  Based on these difficulties, a controller structure was 
presented that works with the motion of the user to produce the intended maneuver without 
requiring an explicit model.  The structure of the controller, as presented in Section 4, is 
extremely flexible allowing for the easy implementation of new maneuvers or control methods 
as  demonstrated  in  Sections  5  and  6.    The  control  structure  utilized  three  independent 
controller  blocks  to  accomplish  individual  tasks  that  are  the  human  machine  interface, 
trajectory generator and low level controller.  By structuring the controller this way, it provides 
a structure to build on for future additions and improvements while allowing the subjects to 
reliably move through the entire gait. 
This work also presented a method of trajectory generation in Section 4, which allows a 
repetitive, safe ambulation to SCI subjects in eLEGS.  This trajectory generation method was 
structured around a state machine to determine the lower extremity motion that best suits the 
current phase of the gait.  The active trajectory generation method presented in Section 5, 
allows the device to modify the gait actively throughout the swing cycle of the trajectory in 
order to develop the intended foot motion with a trajectory that is not overly conservative.  In 
Section 6, additional improvements to the trajectory generation process were presented that 
generated near optimal trajectories via optimization and that planned step parameters for a 
stable limit cycle gait at a desired velocity.  While these extensions have not reached the level 
of implementation, they have provided significant support for the fact that the trajectory 
generation centered control structure provides the most viable option for a safe, full featured 
mobile exoskeleton controller. 
75 
 
----------------In addition to this, all aspects of the trajectory generation were able to maintain these 
features while producing a gait that is similar to that of an unaffected subject.  While it is very 
possible that a few highly skilled subjects could learn to use the device if the joint trajectories 
were significantly different than that of a healthy gait, by minimizing these differences the 
controller allows more users to adapt to using it.  In addition, the near healthy gait provides 
added incentive for subjects with incomplete injuries to use the device because they are 
actively undergoing driven gait rehabilitation while using the device.  Because these subjects 
potentially have the neurological ability to regain some level of lower extremity function based 
on the nature of their injury, the rehabilitative nature of the mobility device will be extremely 
enticing to this patient population. 
This work also presented the first results of subject testing on the developed controller.  
Because of the difficulties presented by modeling the entire system, including the interaction of 
the user with the device, it is essential that the function of the device is shown in practice as 
opposed to simulation alone.  In Section 7 of this  work three primary design goals were 
evaluated through subject testing.  First, the ability of new users to learn to use the device 
quickly and easily was demonstrated through the results of an initial multi-subject pilot study 
where 6 of the 7 subjects were able to walk unassisted using forearm crutches after only a 
single two-hour session of training.  This is an extremely crucial result that implies the device 
will be able to get people up and walking quickly as opposed to requiring months of training 
prior to experiencing the benefits.  Second, the ability of users to continue to improve with the 
device was demonstrated using an evaluation of one new subject over his first visits and by 
comparing a skilled user to his first few times of walking.  These showed that the users can 
continue to grow more skilled with the device as they continue to use it, potentially leading to 
the possibility of subjects realistically using the device in real mobility environments.  Finally, 
the energy expenditure required to use the device was shown to drop significantly from that of 
conventional walking aids by evaluating oxygen consumption rates for a single subject.  This is 
also a significant result because one of the primary drawbacks from the widespread adoption of 
conventional walking braces is that they require too much energy from the SCI subject.  Thus, 
by significantly reducing the required energy expenditure the potential for widespread use is 
still possible. 
8.2  FUTURE WORK 
The development of the controller for this device is the first comprehensive control 
strategy for a mobility exoskeleton for SCI patients.  As the first in its field, the application of 
this device leads to as many open questions and possibilities as it does answers.  Presented 
here are a collection of the primary areas that require additional work in the future to further 
the capabilities of this device.  
The  first  area  that  requires  additional  attention  is  the  area  of  pose  estimation.  
Currently, the pose of the device is estimated using only the measured joint angles of the 
device  along  with  the  sagittal  plane  absolute  angle  of  the  torso  to  calculate  a  Cartesian 
76 
 
----------------coordinate estimate of the current exoskeleton pose.  While this is a good start, the joint angles 
are considered perfect sources of state information and the exoskeleton mechanical assembly 
is assumed to be perfectly rigid, which are both incorrect assumptions.  In addition to this, 
there is no information regarding the angle of the ankle, so when estimating the toe position, 
the ankle is assumed to be at the neutral position.  As implemented, the toe of the swing leg is 
only able to be estimated within about 3 inches of its actual location because a few degrees of 
total error at the joints can lead to significant deviations.  This implementation is currently one 
of the only options because no source of redundant information exists regarding the device’s 
absolute pose.  Many options exist, but they will require significant work in modeling and signal 
processing.  One such example is to include a sagittal plane accelerometer and gyroscope in the 
ankle of the exoskeleton and use the newly available information to generate an absolute angle 
for the foot of the device so as to provide redundant information on the absolute acceleration 
of the foot.  This information, along with a 7-link sagittal plane model where the links are 
modeled as rotational springs, could be fused using an extended kalman filter or a particle filter 
to estimate the actual pose of the device.  An accurate estimation of the robot’s pose could 
then be used in many ways to improve the functionality of the device by providing direct 
feedback into the active swing trajectory method about step length and clearance height or 
allowing more precise model based control methods for advanced features such as standing or 
balancing. 
This leads directly into the next area that deserves further attention, which is methods 
for active balancing of the device or balance assistance to the user in standing and walking.  The 
easiest active balancing problem is to actively balance the device while in a stationary standing 
position because a desired set point can be easily specified, and with the existing actuation at 
the hip, it is very similar to the classical control problem of the acrobat which is an inverted 
double pendulum with actuation in the middle.  While the source actuation may exist, there are 
still some major issues regarding system identification of the mass distribution of the user 
because the device will be designed to work with any user who wears the device.  Because the 
control for this application will most likely be model centered, an inaccurate model may lead to 
significant control limitations due to safety for the user.  Another issue that must be addressed 
when it comes to balance is whether the hip is the best method for control of balance at all or if 
the balance can be more robustly implemented with the addition of an active ankle.  Because 
the hip has a direct effect on the relation of the torso to the legs and the torso comprises most 
of the mass for the system, it is reasonable to believe that it can have a significant effect on the 
balance of the device.  However, because the ankle is located directly at the point of balance, it 
may present a better location to input small amplitude, but high frequency input to the system 
by actively stiffening or actuating the device by a method of active control or active dampening.  
After all of this is evaluated, the next extension for this technology is to the area of single 
stance balance assistance similar to what an unaffected human subject does.  This application is 
generally more complicated due to the limited ability to predefine a desired set balance point 
because the single stance phase is a dynamic motion and directly associated with the forward 
momentum of the gait. 
77 
 
----------------The next area that deserves some specific attention is the use of the stance phases of 
the gait for forward propulsion.  This is extremely important because currently the users gain 
their forward propulsion primarily with the aid of gravity through falling forward through the 
stance phases of the gait.  It may be possible, through the use of better posture control and 
balancing, to monitor the forward momentum of the step through the stance phases to control 
and  actively  add  a  level  of  propulsion to the user  while  walking.   This  area  is  extremely 
dependent on the first two areas identified for future work, but it is the first that will lead to 
the  direct  result  of  faster  overground  walking  that  for  many  is  the  critical  metric  for 
determining the feasibility of mobility devices in the general market.  One aspect that may 
prove necessary towards executing a final solution is actuation out of the sagittal plane to assist 
the user with coronal plane weight shift.  This is extremely important because the addition of 
significant forward propulsion is not helpful if the user is not capable of controlling the coronal 
motion of the body at the higher speeds. 
The final area that stands out as needing further work is the area of variable assist for 
the rehabilitation and mobility effectiveness of high functioning incomplete patients.  While the 
current state of the art in rehabilitation is moving toward force feedback and impedance based 
control [31, 32], it is unclear how this transfers to mobile walking where, if the user fails to 
respond  to  the  force  feedback,  they  fall.    In  addition  to  that,  even  in  solely  mobility 
applications, the user is able to process and respond to the environment much better than the 
exoskeleton will be able to in the foreseeable future because of additional sensor inputs such as 
sight and a more capable form of fusing all of the sensor information together so it makes sense 
to use the input of these users when it is available.  The current approach is focused on 
completely positioning the user, and while other research has focused on responding to the 
motions of the user, no unifying method exists that encompasses variable assistance levels 
from 100% assistance as currently provided to the possible 0% assistance available in other 
devices. 
8.3  CLOSING 
In  the  end,  this  work presents  a  flexible  control  structure  and a  novel  method  of 
trajectory generation that is robust and extremely capable.  It develops the first comprehensive 
control architecture for a mobility exoskeleton for SCI patients and lays the framework for a 
new  area  of  research  into  the  human  centered  control  of  mobility  exoskeletons.    It  is 
implemented and presented in a manner that allows significant research into isolated aspects 
of the controller function without losing or compromising the function of the remainder of the 
controller.  This work presents the first significant subject testing of a device of this nature, as 
well as demonstrates significant improvements over the existing drawbacks of current mobility 
options. 
78 
 
----------------9  REFERENCES 
1  Reeve Foundation. One Degree of Separation: Paralysis and Spinal Cord Injury in the 
United States. 2009. Retrieved March 05, 2011 from http://www.christopherreeve.org/ 
atf/cf/%7B3d83418f-b967-4c18-8ada-adc2e5355071%7D/8112REPTFINAL.PDF 
2  The National SCI Statistical Center, Spinal Cord Injury: Facts and Figures at a Glance, 
Birmingham: University of Alabama at Birmingham National SCI Center, 2009. 
3  M. van der Berg, J. Castellote, I. Mahillo-Fernandez, J. de Pedro-Cuesta. “Incidence of 
Spinal Cord Injury Worldwide: A Systematic Review.” Neuroepidemology, vol. 34, pp. 
184-192, 2010. 
4  I.  Sie,  R.  Waters.  “Outcomes  Following  Spinal  Cord  Injury.”  Spinal  Cord  Medicine: 
Principles and Practice, 1st ed. V. Lin, D. Cardenas, eds. New York, NY: Demos Medical 
Publishing, 2002, Ch 5. 
5  J. Schmitt, J. James, M. Midha, B. Armstrong, J. McGurl. “Primary Care for Persons with 
Spinal Cord Injury.” Spinal Cord Medicine: Principles and Practice, 1st ed. V. Lin, D. 
Cardenas, eds. New York, NY: Demos Medical Publishing, 2002, Ch 19. 
6  J. Eng, S. Levins, A. Townson, D. Mah-Jones, J. Bremner, G. Huston. “Use of Prolonged 
Standing for Individuals With Spinal Cord Injuries.” Physical Therapy, vol. 81, no. 8, pp. 
1392-1399, 2001. 
7  B. Issekutz, J. Blizzard, N. Birkhead, K. Rodahl. “Effect of Prolonged Bed Rest on Urinary 
Calcium Output.” Journal of Applied Physiology, vol. 21, no. 3, pp. 1013-1020, 1966. 
8  S. Goemaere, M. Van Laere, P. De Neve, J. Kaufman. “Bone Mineral Status in Paraplegic 
Patients Who Do or Do Not Perform Standing.” Osteoporosis International, vol. 4, no. 3, 
pp. 138-143, 1994. 
9  H. Hoenig, T. Murphy, J. Galbraith, M. Zolkewitz. “Case Study to Evaluate a Standing 
Table for Managing Constipation.” SCI Nursing, vol. 18, no. 2, pp. 74-77, 2001. 
10 K. Kuhlemeier, L. Lloyd, S. Stover. “Long-term Followup of Renal Function after Spinal 
Cord Injury.” Journal of Urology, vol. 134, no. 3, pp. 510-513, 1985. 
11 R. Walters, S. Mulroy. “The Energy Expenditure of Normal and Pathologic Gait.” Gait & 
Posture, vol. 9, no. 3, pp. 207-231, 1999. 
12 M. Vukobratovic, D. Hristic, Z. Stojiljkovic. “Development of Active Anthropomorphic 
Exoskeletons.” Medical Biological Engineering, vol. 12, no. 1, pp. 66-80, 1974. 
13 M.  Vukobratovic, A.  Frank,  D.  Juricić.  “On  the  Stability  of  Biped  Locomotion.”  IEEE 
Transactions on Biomedical Engineering, vol. 17, no. 1, pp. 25-36, 1970. 
14 M.  Vukobratovic.  “When  Were  Active  Exoskeletons  Actually  Born?”  International 
Journal of Humanoid Robotics, vol. 4, no. 3, pp. 459-479, 2007. 
15 A.  Zoss,  H.  Kazerooni,  A.  Chu.  “On  the  Mechanical  Design  of  the  Berkeley  Lower 
Extremity Exoskeleton (BLEEX).” 2005 IEEERSJ International Conference on Intelligent 
Robots and Systems, 3132-3139. 
16 E.  Guizzo,  H.  Goldstein.  “The  rise  of  the  body  bots  [robotic  exoskeletons].”  IEEE 
Spectrum, vol. 42, no. 10, 50-56, 2005.  
79 
 
----------------17 H. Kazerooni, J. Racine, R. Steger. “On the Control of the Berkeley Lower Extremity 
Exoskeleton (BLEEX).” 2005 IEEE International Conference on Robotics and Automation, 
4353-4360. 
18 Lockheed  Martin.  “HULC.”  Retrieved  March  06,  2011  from  http://www.lockheed 
martin.com/products/hulc/ 
19 Raytheon. “Time Magazine Names Raytheon XOS2 Most Awesomest Invention of 2010.” 
Retrieved  March  06,  2011  from  http://www.raytheon.com/newsroom/technology/ 
rtn08_exoskeleton/ 
20 Cyberdyne. “HAL.” Retrieved March 06, 2011 from http://www.cyberdyne.jp/english/ 
robotsuithal/index.html 
21 H. Kawamoto, S. Yoshiyuki. “Power Assist Method Based on Phase Sequence and Muscle 
Force Condition for HAL.” Journal Advanced Robotics, vol. 19, no. 7, pp. 717–734, 2005. 
22 H.  Kawamoto  et  al.  “Power  Assist  Method  for  HAL-3  using  EMG-based  Feedback 
Controller.”  IEEE International Conference on Systems Man and Cybernetics, pp. 1648-
1653, 2003. 
23 Hocoma. “Lokomat – Enhanced Functional Locomotion Therapy.” Retrieved March 08, 
2011 from http://www.hocoma.com/en/products/lokomat/ 
24 G.  Colombo,  M.  Jörg,  V.  Dietz.  “Driven  Gait  Orthosis  to  do  Locomotor  Training  of 
Paraplegic Patients” Proceedings of the 22nd Annual EMBS International Conference, 
2000. 
25 G. Colombo, M. Wirz, V. Dietz. “Driven Gait Orthosis for Improvement of Locomotor 
Training in Paraplegic Patients,” Spinal Cord, vol. 39, no. 5, pp. 252-255, May 2001. 
26 G. West, “Powered Gait Orthosis and Method of Utilizing Same,” US Patent #6689075, 
Feb. 10, 2004. 
27 G. West, “Powered Gait Orthosis and Method of Utilizing Same,” US Patent #7041069, 
May 9, 2006. 
28 Laboratory Biomedical Engineering, University of Twente. “LOPES.” Retrieved March 12, 
2011 from http://www.bw.ctw.utwente.nl/research/projects/lopes.doc/index.html 
29 Mechanical Systems Laboratory, University of Delaware. “Medical Robotics.” Retrieved 
March 12, 2011 from http://mechsys4.me.udel.edu/research/medical_robotics/ 
30 J. Veneman, R. Kruidhof, E. Hekman, R. Ekkelenkamp, E. Van Asseldonk, H. van der Kooij. 
“Design  and  Evaluation  of  the  LOPES  Exoskeleton  Robot  for  Interactive  Gait 
Rehabilitation” IEEE Transactions on Neural Systems and Rehabilitation Engineering, vol. 
15, no. 3, pp. 379-386, 2007.  
31 R.  Ekkelenkamp,  J.  Veneman,  H  van  der  Kooij.  “LOPES:  Selective  Control  of  Gait 
Functions During the Gait Rehabilitation of CVA Patients.” Proceedings of the 2005 IEEE 
9th International Conference on Rehabilitation Robotics, 2005, pp.361-364. 
32 S. Banala, A. Kulpe, S. Agrawal. “A Powered Leg Orthosis of Gait Rehabilitation in Motor-
Impaired Patients.” IEEE International Conference on Robotics and Automation, 2007, 
pp. 4140-4145. 
80 
 
----------------33 S. Banala, S. Agrawal, J. Scholz. “Active Leg Exoskeleton (ALEX) for Gait Rehabilitation of 
Motor-Impaired Patients.” Proceedings of the 2007 IEEE 10th International Conference 
on Rehabilitation Robotics, 2007. 
34 A. Agrawal, S. Banala, S. Agrawal, S. Binder-Macleod. “Design of a Two Degree-of –
freedom Ankle-foot Orthosis for Robotic Rehabilitation,” Proceedings of the 2005 IEEE 
9th International Conference on Rehabilitation Robotics, pp. 41-44, 2005. 
35 D.  Ferris,  G.  Sawicki,  A.  Domingo.  “Powered  Lower  Limb  Orthoses  for  Gait 
Rehabilitation” Topics for Spinal Cord Injury Rehabilitation, vol. 11, no. 2, pp. 34-49, 
2005. 
36 K. Gordon, D. Ferris. “Learning to Walk with a Robotic Ankle Exoskeleton,” Journal of 
Biomechanics, vol. 40, pp. 2636-2644, 2007. 
37 K. Bharadwaj, T. Sugar. “Design of a Robotic Gait Trainer using Spring Over Muscle 
Actuators for Ankle Stroke Rehabilitation,” Journal of Biomedical Engineering, vol. 127, 
pp. 1009-1013, 2005. 
38 J. Blaya, H. Herr. “Adaptive Control of a Variable-Impedance Ankle-Foot Orthosis to 
Assist  Drop-Foot  Gait,”  IEEE  Transactions  on  Neural  Systems  and  Rehabilitation 
Engineering, vol. 12, no. 1, pp. 24-31, 2004. 
39 Tibion.  “Tibion  Bionic  Technologies.”  Retrieved  on  March  08,  2011  from 
http://www.tibion.com/ 
40 REX  Bionics.  “REX  Bionics.”  Retrieved  on  March  08,  2011  from 
http://www.rexbionics.com/ 
41 J. Chestnutt, M. Lau, G. Cheung, J. Kuffner, J. Hodgins, T. Kanade. “Footstep Planning for 
the Honda ASIMO Humanoid.” Proceedings of the 2005 IEEE International Conference on 
Robotics and Automation, pp. 629-634, 2005. 
42 Argo  Medical  Technologies.  “Products.”  Retrieved  on  March  08,  2011  from 
http://www.argomedtec.com/products.asp 
43 A. Goffer, “Gait-Locomotor Apparatus,” US Patent #7153242, Dec. 26, 2006. 
44 H.  Goshgarian.  “Anatomy  and  Function  of  the  Spinal  Cord.”  Spinal  Cord  Medicine: 
Principles and Practice, 1st ed. V. Lin, D. Cardenas, eds. New York, NY: Demos Medical 
Publishing, 2002, Ch 2. 
45 American Spinal Injury Association. “Standard Neurological Classification of Spinal Cord 
Injury,”  Revision  03/06.  Retrieved  on  March  10,  2011  from  www.asia-
spinalinjury.org/publications/2006_Classif_worksheet.pdf 
46 K. Saladin, Anatomy and Physiology: The Unity of Form and Function, 5th ed. Columbus, 
OH: McGraw-Hill, 2009. 
47 D. Winter. Biomechanics and Motor Control of Human Movement, 3rd ed. Hoboken, NJ: 
John Wiley & Sons, 2005. 
48 C. Kirtley. “CGA Normative Gait Database.” Hong Kong Polytechnic University. Retrieved 
March 12, 2011 from http://www.clinicalgaitanalysis.com/data/index.html 
49 J.  Linskell.  “CGA  Normative  Gait  Database.”  Limb  Fitting  Center,  Dundee,  Scotland. 
Retrieved March 12, 2011 from http://www.clinicalgaitanalysis.com/data/index.html 
81 
 
----------------50 J. Rose, J. Gamble, eds. Human Walking, 3rd ed. Baltimore, MD: Lippincott Williams & 
Wilkins, 2005. 
51 A. Zoss. Actuation Design and Implementation for Lower Extremity Human Exoskeletons, 
University of California, Berkeley, 2009. 
52 K.  Kong,  M.  Tomizuka.  “A  Gait  Monitoring  System  Based  on  Air  Pressure  Sensors 
Embedded in a Shoe.” IEEE/ASME Transactions on Mechatronics, vol. 14, no. 3, pp. 358-
370, 2009. 
53 M. Garcia, A. Chatterjee, A. Ruina, M. Coleman. “The Simplest Walking Model: Stability, 
Complexity, and Scaling.” ASME Journal of Biomechanic Engineering, vol. 120, pp. 281-
288, 1998. 
54 S. Machon, T. McMahon. “Ballistic Walking.” Journal of Biomechanics, vol. 13, pp. 49-57, 
1980. 
55 R. Sinnet, A. Ames. “3D Bipedal Walking with Knees and Feet: A Hybrid Geometric 
Approach.” IEEE Conference on Decision and Control, pp. 3208-3213, 2009. 
56 A. Ames, R. Sinnet, E. Wendel. “Three Dimensional Kneed Bipedal Walking: A Hybrid 
Geometric Approach.” Hybrid Systems: Computation and Control, vol. 5469, pp. 16-30, 
2009. 
57 A. Olensek, Z. Matjacic. “Human-like Control Strategy of a Bipedal Walking Model.” 
Robotica, vol. 26, pp. 295-306, 2008. 
58 T. Naruakwa, M. Takahashi, K. Yoshida. “Numerical Simulations of Level Ground Walking 
Based on Passive Walk for Planar Biped Robots with Torso by Hip Actuators.” Journal of 
System Design and Dynamics, vol. 2, no. 2, pp. 463-474, 2008. 
59 R. Kelly. “PD Control with Desired Gravity Compensation of Robotic Manipulators: A 
Review.” International Journal of Robotics Research, vol. 16, no. 5, pp. 660-672, 1997. 
60 A. De Luca, B. Siciliano, L. Zollo. “PD Control with On-line Gravity Compensation for 
Robots with Elastic Joints: Theory and Experiments.” Automatica, vol. 41, iss. 10, pp. 
1809-1819, 2005. 
61 S. Agrawal, S. Banala, A. Fattah, V. Sangwan, V. Krishnamoorthy, J. Scholz, W. Hsu, 
“Assessment of Motion of a Swing Leg and Gait Rehabilitation With a Gravity Balancing 
Exoskeleton,” IEEE Transactions on Neural Systems and Rehabilitation Engineering, vol. 
15, no. 3, pp. 410-420, Sept 2007. 
62 R. Riener, L. Lünenburger, S. Jezernik, M. Anderschitz, G. Colombo, V. Dietz, “Patient-
Cooperative Strategies for Robot-Aided Treadmill Training: First Experimental Results,” 
IEEE Transactions on Neural Systems and Rehabilitation Engineering, vol. 13, no. 3, Sept 
2005, pp. 380-394. 
63 A. Kuo, “Energetics of Actively Powered Locomotion Using the Simplest Walking Model.” 
Journal of Biomechanics, vol.124, pp. 113-120, 2002. 
64 M.  Johnston.  “Movement  Disorders.”  Nelson  Textbook  of  Pediatrics,  18th  ed.  R. 
Kliegman, R. Behrman, H. Jenson, B. Stanton, eds. Philadelphia, PA: Saunders Elsevier, 
2007. Ch 597. 
65 J. Clinkingbeard, J. Gersten, D. Hoehn. “Energy Cost of Ambulation in the Traumatic 
Paraplegic.” American Journal of Physical Medicine, vol. 43, pp. 157-165, 1964. 
82 
 
----------------66 G. Merati, P. Sarchi, M. Ferrarin, A. Pedotti, A. Veicsteinas. “Paraplegic Adaptation to 
Assisted-Walking: Energy Expenditure During Wheelchair versus Orthosis Use.” Spinal 
Cord, vol. 38, no. 1, pp. 37-44, 2000. 
67 R.  Gailey,  M.  Wenger,  M.Raya,  N.Kirk,  K.  Erbs,  P.  Spyropoulos,  M.  Nash.  “Energy 
Expenditure  of  Trans-Tibial  Amputees  During  Ambulation  at  Self-Selected  Pace.” 
Prosthetics and Orthotics International, vol. 18, pp. 84-91, 1994. 
68 J. Medbo, A. Mohn, I. Tabata, R. Bahr, O. Vaage, O. Sejersted. “Anaerobic Capacity 
Determined by Maximal Accumulated O2 deficit.” Journal of Applied Physiology, vol. 64, 
no. 1, pp. 50-60, 1988. 
83 
 
----------------10 APPENDIX: 3 LINK WALKING MODEL IMPACT RESET DERIVATION 
The equations of reset at the impact event of heelstrike for the 3 link simplified sagittal 
plane walking model as provided in Section 3.1.1 are computed based on the conservation of 
angular momentum.  The conservation of angular momentum is calculated using simple rigid 
body impact model which allows for an instantaneous impact and a discontinuity in angular 
velocity but not in the angle of any segment.  For the 3 member linked chain in this problem, 
this is calculated by balancing 3 conditions as presented below: 
•  Conservation of angular momentum of the whole body about the impact foot 
•  Conservation of angular momentum of the original stance leg about the hip 
•  Conservation of angular momentum of the torso about the hip 
These three conditions are generated by isolating the system into segments that have 
only one source of impulse forces acting on them and then conserving momentum about the 
location of the impulse forces.  Only impulse forces are considered in this derivation because 
the integral of non impulse forces over an instantaneous impact is zero as shown in Equation 
10.1 
 
AX
w x
= (cid:16)  → @AX = @(cid:16)AB → ∆X = ∆(cid:16)(cid:2)(cid:18) →(cid:18) (cid:4) ≈ 0
AB Equation 10.1 
The angular momentum about a point is calculated as shown in Equation 10.2. 
 
Xs = W A/s ×(cid:22)/{/ Equation 10.2 
/
where 
      Angular Momentum about Point A 
    Xs   Vector from Point A to Center of Mass of Link i 
    A /s  Mass of Link i 
    (cid:22) /  Velocity of Center of Mass of Link i 
{ /
The individual computation of the first condition is completed based off Figure 10.1. 
84 
 
---------------- 
(A)      (B)      (C) 
Figure 10.1 – Angular Momentum Conservation Conditions 
A Conservation of angular momentum condition 1 of whole body about impact position, B) Conservation 
of momentum condition 2 of original stance leg about hip, C) Conservation of angular momentum 
condition 3 of torso about hip 
 
 
( ( ( ) ) )
X!| +X(cid:25)| +X(cid:26)s = X!| +X(cid:25)| +X(cid:26)s Equation 10.3 
where 
 
) )
X/s = A/s ×(cid:22)/ {/
(cid:27)/ = (cid:24)/ +(cid:28)/  
A!s = [(cid:27)(cid:23)cos(cid:3)(cid:25) −(cid:28)(cid:23)cos(cid:3)! (cid:27)(cid:23)sin(cid:3)(cid:25) −(cid:28)(cid:23)sin(cid:3)!]
A(cid:25)s = [(cid:24)(cid:23)cos(cid:3)(cid:25) (cid:24)(cid:23)sin(cid:3)(cid:25)]  
A(cid:26)s = [(cid:27)(cid:23)cos(cid:3)(cid:25) +(cid:24)(cid:26)cos(cid:3)(cid:26) (cid:27)(cid:23)sin(cid:3)(cid:25) +(cid:24) (cid:26)sin(cid:3)(cid:26)]
( ( (
{! = [−(cid:24)(cid:23)(cid:3)(cid:10)! sin(cid:3)! (cid:24)(cid:23)(cid:3)(cid:10)! cos(cid:3)!]  
( ( ( ( (
{(cid:25) = [−(cid:27)(cid:23)(cid:3)(cid:10)! sin(cid:3)! +(cid:28)(cid:23)(cid:3)(cid:10)(cid:25) sin(cid:3)(cid:25) (cid:27)(cid:23)(cid:3)(cid:10)! cos(cid:3)! −(cid:28)(cid:23)(cid:3)(cid:10)(cid:25) cos(cid:3)(cid:25)] 
( ( ( ( (
{(cid:26) = [−(cid:27)(cid:23)(cid:3)(cid:10)! sin(cid:3)! −(cid:24)(cid:26)(cid:3)(cid:10)(cid:26) sin(cid:3)(cid:26) (cid:27)(cid:23)(cid:3)(cid:10)! cos(cid:3)! +(cid:24)(cid:26)(cid:3)(cid:10)(cid:26) cos(cid:3)(cid:26)] 
) ) ) ) )
{! = [−(cid:27)(cid:23)(cid:3)(cid:10)(cid:25) sin(cid:3)(cid:25) +(cid:28)(cid:23)(cid:3)(cid:10)! sin(cid:3)! (cid:27)(cid:23)(cid:3)(cid:10)(cid:25) cos(cid:3)(cid:25) −  (cid:28)(cid:23)(cid:3)(cid:10)! cos(cid:3)!]
) ) )
{(cid:25) = [−(cid:24)(cid:23)(cid:3)(cid:10)(cid:25) sin(cid:3)(cid:25) (cid:24)(cid:23)(cid:3)(cid:10)(cid:25) cos(cid:3)(cid:25)]  
) ) ) ) )
{(cid:26) = [−(cid:27)(cid:23)(cid:3)(cid:10)(cid:25) sin(cid:3)(cid:25) −(cid:24)(cid:26)(cid:3)(cid:10)(cid:26) sin(cid:3)(cid:26) (cid:27)(cid:23)(cid:3)(cid:10)(cid:25) cos(cid:3)(cid:25) +(cid:24)(cid:26)(cid:3)(cid:10)(cid:26) cos(cid:3)(cid:26)]
The computation of condition 2 is computed as shown in Equation 10.4 where the 
velocities are the same as presented previously in this section. 
 
 
( )
X!} = X!} Equation 10.4 
85 
 
----------------where 
 
) )
X/~ = A/~ ×(cid:22)/ {/
(cid:27)/ = (cid:24)/ +(cid:28)/  
A!~ = [−(cid:28)!cos(cid:3)! −(cid:28)!sin(cid:3)!]
The computation of condition 2 is computed as shown in Equation 10.5 where the 
velocities are the same as presented previously in this section. 
 
 
( )
X(cid:127)€ = X(cid:127)€ Equation 10.5 
where 
 
) )
X/(cid:129) = A/(cid:129) ×(cid:22)/ {/
(cid:27)/ = (cid:24)/ +(cid:28)/  
A(cid:26)(cid:129) = [(cid:24)!cos(cid:3)(cid:26) (cid:24)(cid:26)sin(cid:3)(cid:26)]
 
Following  expansion  and  simplification,  these  three  conditions  solve  to  the  system 
presented in Equation 10.6 where   and   are the resulting transformation matrices from 
the simplified system.  ( )
' '
( )
(cid:3)(cid:10)! (cid:3)(cid:10)!  
( ( ) )
' (cid:21)(cid:3)(cid:10)(cid:25)# = ' (cid:21)(cid:3)(cid:10)(cid:25)#
( )
(cid:3)(cid:10)(cid:26) (cid:3)(cid:10)(cid:26) Equation 10.6 
where 
 
* −(cid:22)(cid:23)(cid:24)(cid:23)(cid:28)(cid:23) (cid:22)(cid:26)(cid:24)(cid:26)(cid:2)(cid:27)(cid:23)cos(cid:2)(cid:3)(cid:25) −(cid:3)(cid:26)(cid:4)+(cid:24)(cid:26)(cid:4)
(
' = (cid:21) −(cid:22)(cid:23)(cid:24)(cid:23)(cid:28)(cid:23) 0 0 #
(cid:25)
(cid:22)(cid:26)(cid:24)(cid:26)(cid:27)(cid:23)cos(cid:2)(cid:3)! −(cid:3)(cid:26)(cid:4) 0 (cid:22)(cid:26)(cid:24)(cid:26)  
* = (cid:2)2(cid:22)(cid:23)(cid:24)(cid:23) +(cid:22)(cid:26)(cid:27)(cid:23)(cid:4)(cid:27)(cid:23)cos(cid:2)(cid:3)! −(cid:3)(cid:25)(cid:4)+(cid:22)(cid:26)(cid:24)(cid:26)(cid:27)(cid:23)cos(cid:2)(cid:3)! −(cid:3)(cid:26)(cid:4)−(cid:22)(cid:23)(cid:28)(cid:23)(cid:24)(cid:23)
(cid:22)(cid:23)(cid:28)(cid:23)(cid:2)(cid:28)(cid:23) −(cid:27)(cid:23)cos(cid:2)(cid:3)! −(cid:3)(cid:25)(cid:4)(cid:4) , (cid:22)(cid:26)(cid:24)(cid:26)(cid:2)(cid:27)(cid:23)cos(cid:2)(cid:3)(cid:25) −(cid:3)(cid:26)(cid:4)+(cid:24)(cid:26)(cid:4)  
) (cid:25)
' = (cid:21) (cid:22)(cid:23)(cid:28)(cid:23) −(cid:22)(cid:23)(cid:28)(cid:23)(cid:27)(cid:23)cos(cid:2)(cid:3)! −(cid:3)(cid:25)(cid:4) 0 #
(cid:25)
0 (cid:22)(cid:26)(cid:24)(cid:26)(cid:27)(cid:23)cos(cid:2)(cid:3)(cid:25) −(cid:3)(cid:26)(cid:4) (cid:22)(cid:26)(cid:24)(cid:26)
 
(cid:25) (cid:25)
  , = (cid:22)(cid:23)(cid:24)(cid:23) +(cid:2)(cid:22)(cid:23) +(cid:22)(cid:26)(cid:4)(cid:27)(cid:23) −(cid:22)(cid:23)(cid:28)(cid:23)(cid:27)(cid:23)cos(cid:2)(cid:3)! −(cid:3)(cid:25)(cid:4)+(cid:22)(cid:26)(cid:24)(cid:26)(cid:27)(cid:23)cos(cid:2)(cid:3)(cid:25) −(cid:3)(cid:26)(cid:4)
86 
 
----------------11 APPENDIX: TRAJECTORY GENERATION BLENDING 
11.1 LINEAR BLENDING 
The  linear  blending  used  in  the  trajectory  generation  is  designed  to  be  easy  to 
implement and to only have setup calculations at the beginning of the blend operation.  This 
blend is intended to result in a function that is zero order continuous.  In the case that two lines 
are being blended as shown in Figure 11.1, the calculation is made to blend out the initial error 
between the two lines over a set amount of time.  Thus, the final line can be explicitly defined 
as a piecewise function as shown in Equation 11.1. 
‚!(cid:2)B(cid:4) B ≤ 0
 
B
‚(cid:2)B(cid:4) = ƒ‚(cid:25)(cid:2)B(cid:4)+L2(cid:2)1− (cid:4) 0 < B < B~uHPo…
B~uHPo
Equation 11.1 
‚(cid:25)(cid:2)B(cid:4) B ≤ B~uHPo
where 
 
L2 = ‚!(cid:2)B2(cid:4)−‚(cid:25)(cid:2)B2(cid:4)
1.5  
Function 1
Function 2
Blend Output
e
u
al
V
ut  1
p
ut
O
0.5 
-0.5 0 0.5 1 1.5
Time [s]  
Figure 11.1 – Trajectory Generation Zero Order Continuous Blend 
Blend starting at time 0 with a blend time of 1 s. 
11.2 FIRST ORDER CONTINUOUS BLENDING 
This blend is similar to that used in the linear blend, but it is attempting to maintain a 
continuous velocity throughout the blending process.  The result of the blend can be seen in 
Figure 11.2 with the piecewise explicit solution provided in Equation 11.2. 
87 
 
---------------- 
‚!(cid:2)B(cid:4) B ≤ 0
‡ (cid:25)
‚(cid:2)B(cid:4) = †‚(cid:25)(cid:2)B(cid:4)+*B +,B +SB+- 0 < B < B~uHPo…
Equation 11.2 
‚(cid:25)(cid:2)B(cid:4) B ≤ B~uHPo
  where 
 
- = L2 = ‚!(cid:2)B2(cid:4)−‚(cid:25)(cid:2)B2(cid:4) 
S = L(cid:10)2 = ‚!(cid:10) (cid:2)B2(cid:4)−‚(cid:25)(cid:10) (cid:2)B2(cid:4)
 
L(cid:10)2 L2
, = −2 −3 (cid:25)
B~uHPo B~uHPo
 
L(cid:10)2 L2
* = (cid:25) +2 ‡
B~uHPo B~uHPo
1.5  
Function 1
Function 2
Blend Output
e
u
al
V
ut  1
p
ut
O
0.5 
-0.5 0 0.5 1 1.5
Time [s]  
Figure 11.2 – Trajectory Generation First Order Continuous Blend 
Blend starting at time 0 with a blend time of 1 s. 
88 
 
----------------12 APPENDIX: NEAR OPTIMAL TRAJECTORY GENERATION DYNAMICS 
The system being modeled for this analysis is a four link point mass walking model with 
a torso.  The system has a straight stance leg and a kneed swing leg as shown in Figure 6.4.  The 
complete description of this model is located in Section 6.1.   
The dynamics were solved using Legrangian dynamics and can be stored in the form 
provided in Equation 12.1.  The individual equations that make up this master system are 
provided in Equation 12.2 to Equation 12.5. 
 
 
(cid:1)(cid:2)(cid:3)(cid:4)(cid:3)(cid:5) +(cid:7)(cid:2)(cid:3)(cid:10),(cid:3)(cid:4)+(cid:12)(cid:2)(cid:3)(cid:4) = ; Equation 12.1 
where 
(cid:3)(cid:17)(cid:18)  
(cid:3)(cid:26)D
(cid:3) = ‰ Š
(cid:3)(cid:17)D
(cid:3)(cid:26)I
 
;(cid:17)(cid:18)
; = ?;(cid:26)DC
  ;(cid:17)D
(cid:25) (cid:25)
;(cid:17)(cid:18) = (cid:2)(cid:2)(cid:22)(cid:26)D +(cid:22)(cid:17)D +(cid:22)(cid:26)I(cid:4)(cid:27)(cid:17)(cid:18) +(cid:22)(cid:17)(cid:18)(cid:24)(cid:17)(cid:18)(cid:4)(cid:3)(cid:17)(cid:5) (cid:18) −(cid:27)(cid:17)(cid:18)(cid:2)(cid:22)(cid:26)D(cid:28)(cid:26)D +(cid:22)(cid:17)D(cid:27)(cid:26)D(cid:4)cos(cid:2)(cid:3)(cid:17)(cid:18) −(cid:3)(cid:26)D(cid:4)(cid:3)(cid:5)(cid:26)D
−(cid:22)(cid:17)D(cid:28)(cid:17)D(cid:27)(cid:26)Dcos(cid:2)(cid:3)(cid:17)(cid:18) −(cid:3)(cid:17)D(cid:4)(cid:3)(cid:17)(cid:5) D +(cid:22)(cid:26)I(cid:24)(cid:26)I(cid:27)(cid:26)Dcos(cid:2)(cid:3)(cid:17)(cid:18) −(cid:3)(cid:26)I(cid:4)(cid:3)(cid:5)(cid:26)I
(cid:25) (cid:25)
−(cid:27)(cid:17)(cid:18)(cid:3)(cid:10)(cid:26)D(cid:2)(cid:22)(cid:26)D(cid:28)(cid:26)D +(cid:22)(cid:17)D(cid:27)(cid:26)D(cid:4)sin(cid:2)(cid:3)(cid:17)(cid:18) −(cid:3)(cid:26)D(cid:4)−(cid:22)(cid:17)D(cid:28)(cid:17)D(cid:27)(cid:17)(cid:18)(cid:3)(cid:17)(cid:10) Dsin(cid:2)(cid:3)(cid:17)(cid:18) −(cid:3)(cid:17)D(cid:4)  
(cid:25)
+(cid:22)(cid:26)I(cid:24)(cid:26)I(cid:27)(cid:17)(cid:18)(cid:3)(cid:10)(cid:26)Isin(cid:2)(cid:3)(cid:17)(cid:18) −(cid:3)(cid:26)I(cid:4)+&(cid:2)(cid:2)(cid:22)(cid:26)D +(cid:22)(cid:17)D +(cid:22)(cid:26)I(cid:4)(cid:27)(cid:17)(cid:18) +(cid:22)(cid:17)E(cid:18)(cid:24)q(cid:17)u(cid:18)a(cid:4)tcioosn(cid:2) 1(cid:3)2(cid:17)(cid:18).2(cid:4) 
 
(cid:25) (cid:25)
;(cid:26)D +;(cid:17)D = −(cid:27)(cid:17)(cid:18)(cid:2)(cid:22)(cid:26)D(cid:28)(cid:26)D +(cid:22)(cid:17)D(cid:27)(cid:26)D(cid:4)cos(cid:2)(cid:3)(cid:17)(cid:18) −(cid:3)(cid:26)D(cid:4)(cid:3)(cid:17)(cid:5) (cid:18) +(cid:2)(cid:22)(cid:26)D(cid:28)(cid:26)D +(cid:22)(cid:17)D(cid:27)(cid:26)D(cid:4)(cid:3)(cid:5)(cid:26)D
(cid:25)
+(cid:22)(cid:17)D(cid:28)(cid:17)D(cid:27)(cid:26)Dcos(cid:2)(cid:3)(cid:26)D −(cid:3)(cid:17)D(cid:4)(cid:3)(cid:5)(cid:17)D +(cid:27)(cid:17)(cid:18)(cid:3)(cid:17)(cid:10) (cid:18)(cid:2)(cid:22)(cid:26)D(cid:28)(cid:26)D +(cid:22)(cid:17)D(cid:27)(cid:26)D(cid:4)sin(cid:2) (cid:3)(cid:17)(cid:18) −(cid:3)(cid:26)D(cid:4)
(cid:25)
+(cid:22)(cid:17)D(cid:28)(cid:17)D(cid:27)(cid:26)D(cid:3)(cid:17)(cid:10) Dsin(cid:2)(cid:3)(cid:26)D −(cid:3)(cid:17)D(cid:4)−&(cid:2)(cid:22)(cid:26)D(cid:28)(cid:26)D +(cid:22)(cid:17)D(cid:27)(cid:26)D(cid:4)cos(cid:2)(cid:3)(cid:26)DE(cid:4)quation 12.3 
 
89 
 
----------------(cid:25)
−;(cid:17)D = −(cid:22)(cid:17)D(cid:28)(cid:17)D(cid:27)(cid:17)(cid:18)cos(cid:2)(cid:3)(cid:17)(cid:18) −(cid:3)(cid:17)D(cid:4)(cid:3)(cid:17)(cid:5) (cid:18) +(cid:22)(cid:17)D(cid:28)(cid:17)D(cid:27)(cid:26)Dcos(cid:2)(cid:3)(cid:26)D −(cid:3)(cid:17)D(cid:4)(cid:3)(cid:5)(cid:26)D +(cid:22)(cid:17)D(cid:28)(cid:17)D(cid:3)(cid:17)(cid:5) D
(cid:25) (cid:25)
+(cid:22)(cid:17)D(cid:28)(cid:17)D(cid:27)(cid:17)(cid:18)(cid:3)(cid:17)(cid:10) (cid:18)sin(cid:2)(cid:3) (cid:17)(cid:18) −(cid:3)(cid:17)D(cid:4)−(cid:22)(cid:17)D(cid:28)(cid:17)D(cid:27)(cid:26)D(cid:3)(cid:10)(cid:26)Dsin(cid:2)(cid:3)(cid:26)D −(cid:3)(cid:17)D(cid:4)
+(cid:22)(cid:17)D(cid:28)(cid:17)D&cos(cid:2)(cid:3)(cid:17)D(cid:4) Equation 12.4 
 
(cid:25) (cid:25)
−;(cid:17)(cid:18) −;(cid:26)I = (cid:22)(cid:26)I(cid:24)(cid:26)I(cid:27)(cid:17)(cid:18)cos(cid:2)(cid:3)(cid:17)(cid:18) − (cid:3)(cid:26)I(cid:4)(cid:3)(cid:17)(cid:5) (cid:18) −(cid:22)(cid:26)I(cid:24)(cid:26)I(cid:3)(cid:5)(cid:26)I −(cid:22)(cid:26)I(cid:24)(cid:26)I(cid:27)(cid:17)(cid:18)(cid:3)(cid:17)(cid:10) (cid:18)sin(cid:2)(cid:3)(cid:17)(cid:18) −(cid:3)(cid:26)I(cid:4)
+(cid:22)(cid:26)I(cid:24)(cid:26)I&cos(cid:2)(cid:3)(cid:26)I(cid:4) Equation 12.5 
where 
 
(cid:28)(cid:23)/P‹ = (cid:27)(cid:23)/P‹ −(cid:24)(cid:23)/P‹ ∀ (cid:27)YZq
90 
 
----------------